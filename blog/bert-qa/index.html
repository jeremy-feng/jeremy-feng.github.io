
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Coding, AI, and Life">
      
      
        <meta name="author" content="Jeremy Feng">
      
      
        <link rel="canonical" href="https://fengchao.pro/blog/bert-qa/">
      
      
        <link rel="prev" href="../variable-selection-via-nonconcave-penalized-likelihood/">
      
      
        <link rel="next" href="../qlib/">
      
      
        
      
      
      <link rel="icon" href="../avatar.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>基于 Bert 的中文问答机器人 - Jeremy Feng's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      
  
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M64%20480c-35.3%200-64-28.7-64-64V96c0-35.3%2028.7-64%2064-64h320c35.3%200%2064%2028.7%2064%2064v213.5c0%2017-6.7%2033.3-18.7%2045.3L322.7%20461.3c-12%2012-28.3%2018.7-45.3%2018.7zm325.5-176H296c-13.3%200-24%2010.7-24%2024v93.5z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M384%20512H96c-53%200-96-43-96-96V96C0%2043%2043%200%2096%200h304c26.5%200%2048%2021.5%2048%2048v288c0%2020.9-13.4%2038.7-32%2045.3V448c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032zM96%20384c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h256v-64zm32-232c0%2013.3%2010.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24H152c-13.3%200-24%2010.7-24%2024m24%2072c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m-32-352a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m-8%2064h48c13.3%200%2024%2010.7%2024%2024v88h8c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-80c-13.3%200-24-10.7-24-24s10.7-24%2024-24h24v-64h-24c-13.3%200-24-10.7-24-24s10.7-24%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M461.2%2018.9C472.7%2024%20480%2035.4%20480%2048v416c0%2012.6-7.3%2024-18.8%2029.1s-24.8%203.2-34.3-5.1l-46.6-40.7c-43.6-38.1-98.7-60.3-156.4-63V480c0%2017.7-14.3%2032-32%2032h-32c-17.7%200-32-14.3-32-32v-96C57.3%20384%200%20326.7%200%20256s57.3-128%20128-128h84.5c61.8-.2%20121.4-22.7%20167.9-63.3L427%2024c9.4-8.3%2022.9-10.2%2034.3-5.1zM224%20320v.2c70.3%202.7%20137.8%2028.5%20192%2073.4V118.3c-54.2%2044.9-121.7%2070.7-192%2073.4z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.2-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20352a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m0-192c-18.2%200-32.7%2015.5-31.4%2033.7l7.4%20104c.9%2012.5%2011.4%2022.3%2023.9%2022.3%2012.6%200%2023-9.7%2023.9-22.3l7.4-104c1.3-18.2-13.1-33.7-31.4-33.7z%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M480-16c6.9%200%2013%204.4%2015.2%2010.9l13.5%2040.4%2040.4%2013.5C555.6%2051%20560%2057.1%20560%2064s-4.4%2013-10.9%2015.2l-40.4%2013.5-13.5%2040.4c-2.2%206.5-8.3%2010.9-15.2%2010.9s-13-4.4-15.2-10.9l-13.5-40.4-40.4-13.5C404.4%2077%20400%2070.9%20400%2064s4.4-13%2010.9-15.2l40.4-13.5%2013.5-40.4C467-11.6%20473.1-16%20480-16M321.4%2097.4c12.5-12.5%2032.8-12.5%2045.3%200l80%2080c12.5%2012.5%2012.5%2032.8%200%2045.3l-10.9%2010.9c7.9%2022%2012.2%2045.7%2012.2%2070.5%200%20114.9-93.1%20208-208%20208S32%20418.9%2032%20304%20125.1%2096%20240%2096c24.7%200%2048.5%204.3%2070.5%2012.3zM144%20304c0-53%2043-96%2096-96%2013.3%200%2024-10.7%2024-24s-10.7-24-24-24c-79.5%200-144%2064.5-144%20144%200%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M416%20427.4c58.5-44%2096-111.6%2096-187.4C512%20107.5%20397.4%200%20256%200S0%20107.5%200%20240c0%2075.8%2037.5%20143.4%2096%20187.4V464c0%2026.5%2021.5%2048%2048%2048h32v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h64v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h32c26.5%200%2048-21.5%2048-48zM96%20256a64%2064%200%201%201%20128%200%2064%2064%200%201%201-128%200m256-64a64%2064%200%201%201%200%20128%2064%2064%200%201%201%200-128%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M0%20216C0%20149.7%2053.7%2096%20120%2096h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64zm256%200c0-66.3%2053.7-120%20120-120h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064h-64c-35.3%200-64-28.7-64-64z%22/%3E%3C/svg%3E');}</style>



  
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
  
  <style>:root{.md-tag.md-tag--cs{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M348.8%2032C340.7%2046.1%20336%2062.5%20336%2080v16H64v224h272v64H64c-35.3%200-64-28.7-64-64V96c0-35.3%2028.7-64%2064-64zM336%20432c0%2017.5%204.7%2033.9%2012.8%2048H120c-13.3%200-24-10.7-24-24s10.7-24%2024-24zm96-400h96c26.5%200%2048%2021.5%2048%2048v352c0%2026.5-21.5%2048-48%2048h-96c-26.5%200-48-21.5-48-48V80c0-26.5%2021.5-48%2048-48m24%2064c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24s-10.7-24-24-24zm0%2096c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24s-10.7-24-24-24zm56%20144a32%2032%200%201%200-64%200%2032%2032%200%201%200%2064%200%22/%3E%3C/svg%3E');}.md-tag.md-tag--database{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M448%20205.8c-14.8%209.8-31.8%2017.7-49.5%2024-47%2016.8-108.7%2026.2-174.5%2026.2s-127.6-9.5-174.5-26.2c-17.6-6.3-34.7-14.2-49.5-24V288c0%2044.2%20100.3%2080%20224%2080s224-35.8%20224-80zm0-77.8V80c0-44.2-100.3-80-224-80S0%2035.8%200%2080v48c0%2044.2%20100.3%2080%20224%2080s224-35.8%20224-80m-49.5%20261.8C351.6%20406.5%20289.9%20416%20224%20416s-127.6-9.5-174.5-26.2c-17.6-6.3-34.7-14.2-49.5-24V432c0%2044.2%20100.3%2080%20224%2080s224-35.8%20224-80v-66.2c-14.8%209.8-31.8%2017.7-49.5%2024%22/%3E%3C/svg%3E');}.md-tag.md-tag--dl{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M0%2064c0-17.7%2014.3-32%2032-32h128c123.7%200%20224%20100.3%20224%20224S283.7%20480%20160%20480H32c-17.7%200-32-14.3-32-32zm64%2032v320h96c88.4%200%20160-71.6%20160-160S248.4%2096%20160%2096z%22/%3E%3C/svg%3E');}.md-tag.md-tag--indie-dev{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M120.1%20208.3c-3.9-2.9-7.8-4.3-11.6-4.3H91.1v104.5h17.4c3.9%200%207.8-1.4%2011.6-4.3s5.8-7.3%205.8-13.1v-69.7c0-5.8-2-10.2-5.8-13.1M404.1%2032H43.9C19.7%2032%20.1%2051.6%200%2075.8v360.4C.1%20460.4%2019.7%20480%2043.9%20480h360.2c24.2%200%2043.8-19.6%2043.9-43.8V75.8c-.1-24.2-19.7-43.8-43.9-43.8M154.2%20291.2c0%2018.8-11.6%2047.3-48.4%2047.3H59.4V173h47.4c35.4%200%2047.4%2028.5%2047.4%2047.3zm100.7-88.7h-53.3v38.4h32.6v29.6h-32.6v38.4h53.3v29.6h-62.2c-11.2.3-20.4-8.5-20.7-19.7V193.7c-.3-11.1%208.6-20.4%2019.7-20.7h63.2zm103.6%20115.3c-13.2%2030.7-36.8%2024.6-47.4%200L272.6%20173h32.6l29.7%20113.7L364.5%20173h32.6l-38.5%20144.8z%22/%3E%3C/svg%3E');}.md-tag.md-tag--latex{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m18.5%204%201.16%204.35-.96.26c-.45-.87-.91-1.74-1.44-2.18C16.73%206%2016.11%206%2015.5%206H13v10.5c0%20.5%200%201%20.33%201.25.34.25%201%20.25%201.67.25v1H9v-1c.67%200%201.33%200%201.67-.25.33-.25.33-.75.33-1.25V6H8.5c-.61%200-1.23%200-1.76.43-.53.44-.99%201.31-1.44%202.18l-.96-.26L5.5%204z%22/%3E%3C/svg%3E');}.md-tag.md-tag--leetcode{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M13.483%200a1.37%201.37%200%200%200-.961.438L7.116%206.226l-3.854%204.126a5.3%205.3%200%200%200-1.209%202.104%205%205%200%200%200-.125.513%205.5%205.5%200%200%200%20.062%202.362%206%206%200%200%200%20.349%201.017%205.9%205.9%200%200%200%201.271%201.818l4.277%204.193.039.038c2.248%202.165%205.852%202.133%208.063-.074l2.396-2.392c.54-.54.54-1.414.003-1.955a1.38%201.38%200%200%200-1.951-.003l-2.396%202.392a3.02%203.02%200%200%201-4.205.038l-.02-.019-4.276-4.193c-.652-.64-.972-1.469-.948-2.263a2.7%202.7%200%200%201%20.066-.523%202.55%202.55%200%200%201%20.619-1.164L9.13%208.114c1.058-1.134%203.204-1.27%204.43-.278l3.501%202.831c.593.48%201.461.387%201.94-.207a1.384%201.384%200%200%200-.207-1.943l-3.5-2.831c-.8-.647-1.766-1.045-2.774-1.202l2.015-2.158A1.384%201.384%200%200%200%2013.483%200m-2.866%2012.815a1.38%201.38%200%200%200-1.38%201.382%201.38%201.38%200%200%200%201.38%201.382H20.79a1.38%201.38%200%200%200%201.38-1.382%201.38%201.38%200%200%200-1.38-1.382z%22/%3E%3C/svg%3E');}.md-tag.md-tag--life{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22m241%2087.1%2015%2020.7%2015-20.7C296%2052.5%20336.2%2032%20378.9%2032%20452.4%2032%20512%2091.6%20512%20165.1v2.6c0%20112.2-139.9%20242.5-212.9%20298.2-12.4%209.4-27.6%2014.1-43.1%2014.1s-30.8-4.6-43.1-14.1C139.9%20410.2%200%20279.9%200%20167.7v-2.6C0%2091.6%2059.6%2032%20133.1%2032%20175.8%2032%20216%2052.5%20241%2087.1%22/%3E%3C/svg%3E');}.md-tag.md-tag--linux{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M220.9%20123.3c1%20.5%201.8%201.7%203%201.7%201.1%200%202.8-.4%202.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6%201.1.3%201.3%202.3%201.1%203.4%201.7M199%20125c1.2%200%202-1.2%203-1.7%201.1-.6%203.1-.4%203.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4%201.5-3.2%202.9.1%201%201.8%201.5%202.8%201.4m221%20278.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2%209.2-27.3%205.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1%2085.4%20315.7.1%20234.8%200%20132.4-.2%20158%20103.4%20156.9%20135.2c-1.7%2023.4-6.4%2041.8-22.5%2064.7-18.9%2022.5-45.5%2058.8-58.1%2096.7-6%2017.9-8.8%2036.1-6.2%2053.3-6.5%205.8-11.4%2014.7-16.6%2020.2-4.2%204.3-10.3%205.9-17%208.3s-14%206-18.5%2014.5c-2.1%203.9-2.8%208.1-2.8%2012.4%200%203.9.6%207.9%201.2%2011.8%201.2%208.1%202.5%2015.7.8%2020.8-5.2%2014.4-5.9%2024.4-2.2%2031.7%203.8%207.3%2011.4%2010.5%2020.1%2012.3%2017.3%203.6%2040.8%202.7%2059.3%2012.5%2019.8%2010.4%2039.9%2014.1%2055.9%2010.4%2011.6-2.6%2021.1-9.6%2025.9-20.2%2012.5-.1%2026.3-5.4%2048.3-6.6%2014.9-1.2%2033.6%205.3%2055.1%204.1.6%202.3%201.4%204.6%202.5%206.7v.1c8.3%2016.7%2023.8%2024.3%2040.3%2023%2016.6-1.3%2034.1-11%2048.3-27.9%2013.6-16.4%2036-23.2%2050.9-32.2%207.4-4.5%2013.4-10.1%2013.9-18.3.4-8.2-4.4-17.3-15.5-29.7M223.8%2087.3c9.8-22.2%2034.2-21.8%2044-.4%206.5%2014.2%203.6%2030.9-4.3%2040.4-1.6-.8-5.9-2.6-12.6-4.9%201.1-1.2%203.1-2.7%203.9-4.6%204.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9%2010.8-11.8%2023-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6%202.9-21.8m-40.7-11.5c10.1%200%2020.8%2014.2%2019.1%2033.5-3.5%201-7.1%202.5-10.2%204.6%201.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8%2021.2-1.8%2028.1%201%20.8%201.9-.2-5.9%205.5-15.6-14.6-10.5-52.1%208.4-52.1m-13.6%2060.7c6.2-4.6%2013.6-10%2014.1-10.5%204.7-4.4%2013.5-14.2%2027.9-14.2%207.1%200%2015.6%202.3%2025.9%208.9%206.3%204.1%2011.3%204.4%2022.6%209.3%208.4%203.5%2013.7%209.7%2010.5%2018.2-2.6%207.1-11%2014.4-22.7%2018.1-11.1%203.6-19.8%2016-38.2%2014.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3q-2.1-7.35%204.2-12.3m3.3%20334c-2.7%2035.1-43.9%2034.4-75.3%2018-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7%202.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15%20.9-20%203.5-6.7%208.5-9.1%2014.8-11.3%2010.3-3.7%2011.8-3.4%2019.6-9.9%205.5-5.7%209.5-12.9%2014.3-18%205.1-5.5%2010-8.1%2017.7-6.9%208.1%201.2%2015.1%206.8%2021.9%2016l19.6%2035.6c9.5%2019.9%2043.1%2048.4%2041%2068.9m-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6%207.1%200%2014.2-2.2%2016.7-8.9%202.3-6.2%200-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9%2018.6-45.2%2027.2-59.2%202.3-1.7.8%203.2-8.7%2020.8-8.5%2016.1-24.4%2053.3-2.6%2082.4.6-20.7%205.5-41.8%2013.8-61.5%2012-27.4%2037.3-74.9%2039.3-112.7%201.1.8%204.6%203.2%206.2%204.1%204.6%202.7%208.1%206.7%2012.6%2010.3%2012.4%2010%2028.5%209.2%2042.4%201.2%206.2-3.5%2011.2-7.5%2015.9-9%209.9-3.1%2017.8-8.6%2022.3-15%207.7%2030.4%2025.7%2074.3%2037.2%2095.7%206.1%2011.4%2018.3%2035.5%2023.6%2064.6%203.3-.1%207%20.4%2010.9%201.4%2013.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5%2012.6%2011.2%2029.2%2033.7%2035.2%2059%202.8%2011.6%203.3%2023.7.4%2035.7%2016.4%206.8%2035.9%2017.9%2030.7%2034.8-2.2-.1-3.2%200-4.2%200%203.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3%2012.5-12.1%204.2-18.3%2014.7-21.4%2027.3-2.8%2011.2-3.6%2024.7-4.4%2039.9-.5%207.7-3.6%2018-6.8%2029-32.1%2022.9-76.7%2032.9-114.3%207.2m257.4-11.5c-.9%2016.8-41.2%2019.9-63.2%2046.5-13.2%2015.7-29.4%2024.4-43.6%2025.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1%201.1-36.3%203.7-14.2%209.2-28.8%209.9-40.6.8-15.2%201.7-28.5%204.2-38.7%202.6-10.3%206.6-17.2%2013.7-21.1.3-.2.7-.3%201-.5.8%2013.2%207.3%2026.6%2018.8%2029.5%2012.6%203.3%2030.7-7.5%2038.4-16.3%209-.3%2015.7-.9%2022.6%205.1%209.9%208.5%207.1%2030.3%2017.1%2041.6%2010.6%2011.6%2014%2019.5%2013.7%2024.6M173.4%20148.7c2%201.9%204.7%204.5%208%207.1%206.6%205.2%2015.8%2010.6%2027.3%2010.6%2011.6%200%2022.5-5.9%2031.8-10.8%204.9-2.6%2010.9-7%2014.8-10.4s5.9-6.3%203.1-6.6-2.6%202.6-6%205.1c-4.4%203.2-9.7%207.4-13.9%209.8-7.4%204.2-19.5%2010.2-29.9%2010.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8%203.7%201.7%206.5%22/%3E%3C/svg%3E');}.md-tag.md-tag--llm{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M22.282%209.821a5.99%205.99%200%200%200-.516-4.91%206.05%206.05%200%200%200-6.51-2.9A6.065%206.065%200%200%200%204.981%204.18a5.99%205.99%200%200%200-3.998%202.9%206.05%206.05%200%200%200%20.743%207.097%205.98%205.98%200%200%200%20.51%204.911%206.05%206.05%200%200%200%206.515%202.9A5.99%205.99%200%200%200%2013.26%2024a6.06%206.06%200%200%200%205.772-4.206%206%206%200%200%200%203.997-2.9%206.06%206.06%200%200%200-.747-7.073zM13.26%2022.43a4.48%204.48%200%200%201-2.876-1.04l.141-.081%204.779-2.758a.8.8%200%200%200%20.392-.681v-6.737l2.02%201.168a.07.07%200%200%201%20.038.052v5.583a4.504%204.504%200%200%201-4.494%204.494M3.6%2018.304a4.47%204.47%200%200%201-.535-3.014l.142.085%204.783%202.759a.77.77%200%200%200%20.78%200l5.843-3.369v2.332a.08.08%200%200%201-.033.062L9.74%2019.95a4.5%204.5%200%200%201-6.14-1.646M2.34%207.896a4.5%204.5%200%200%201%202.366-1.973V11.6a.77.77%200%200%200%20.388.677l5.815%203.354-2.02%201.168a.08.08%200%200%201-.071%200l-4.83-2.786A4.504%204.504%200%200%201%202.34%207.872zm16.597%203.855-5.833-3.387L15.119%207.2a.08.08%200%200%201%20.071%200l4.83%202.791a4.494%204.494%200%200%201-.676%208.105v-5.678a.79.79%200%200%200-.407-.667zm2.01-3.023-.141-.085-4.774-2.782a.78.78%200%200%200-.785%200L9.409%209.23V6.897a.07.07%200%200%201%20.028-.061l4.83-2.787a4.5%204.5%200%200%201%206.68%204.66zm-12.64%204.135-2.02-1.164a.08.08%200%200%201-.038-.057V6.075a4.5%204.5%200%200%201%207.375-3.453l-.142.08-4.778%202.758a.8.8%200%200%200-.393.681zm1.097-2.365%202.602-1.5%202.607%201.5v2.999l-2.597%201.5-2.607-1.5Z%22/%3E%3C/svg%3E');}.md-tag.md-tag--ml{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M22.7%2033.4c13.5-4.1%2028.1%201.1%2035.9%2012.9l165.4%20248%20165.4-248c7.8-11.7%2022.4-17%2035.9-12.9S448%2049.9%20448%2064v384c0%2017.7-14.3%2032-32%2032s-32-14.3-32-32V169.7L250.6%20369.8c-5.9%208.9-15.9%2014.2-26.6%2014.2s-20.7-5.3-26.6-14.2L64%20169.7V448c0%2017.7-14.3%2032-32%2032S0%20465.7%200%20448V64c0-14.1%209.2-26.5%2022.7-30.6%22/%3E%3C/svg%3E');}.md-tag.md-tag--or{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M21.8%205c.6%200%201.2.6%201.2%201.3v3.5c0%20.6-.6%201.2-1.3%201.2h-5.5c-.6%200-1.2-.6-1.2-1.3V6.2c0-.6.6-1.2%201.2-1.2V3.5C16.2%202.1%2017.6%201%2019%201s2.8%201.1%202.8%202.5zm-1.3%200V3.5c0-.8-.7-1.3-1.5-1.3s-1.5.5-1.5%201.3V5zM1.74%2019.25l1.47-5.46%201.47%202.55L9%2013.85V3h2v10.85l6.53%203.76L19%2015.03l1.5%205.47-5.5%201.46%201.53-2.61L10%2015.58l-4.32%202.49%201.53%202.64z%22/%3E%3C/svg%3E');}.md-tag.md-tag--python{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M439.8%20200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0%2036.8-31.2%2067.8-66.8%2067.8H172.7c-29.2%200-53.4%2025-53.4%2054.3v101.8c0%2029%2025.2%2046%2053.4%2054.3%2033.8%209.9%2066.3%2011.7%20106.8%200%2026.9-7.8%2053.4-23.5%2053.4-54.3v-40.7H226.2v-13.6h160.2c31.1%200%2042.6-21.7%2053.4-54.2%2011.2-33.5%2010.7-65.7%200-108.6M286.2%20444.7a20.4%2020.4%200%201%201%200-40.7%2020.4%2020.4%200%201%201%200%2040.7M167.8%20248.1h106.8c29.7%200%2053.4-24.5%2053.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2%208-53.4%2024.7-53.4%2055.6v40.7h106.9v13.6h-147c-31.1%200-58.3%2018.7-66.8%2054.2-9.8%2040.7-10.2%2066.1%200%20108.6%207.6%2031.6%2025.7%2054.2%2056.8%2054.2H101v-48.8c0-35.3%2030.5-66.4%2066.8-66.4m-6.6-183.4a20.4%2020.4%200%201%201%200%2040.8%2020.4%2020.4%200%201%201%200-40.8%22/%3E%3C/svg%3E');}.md-tag.md-tag--rust{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22m508.5%20249.8-21.8-13.5c-.2-2-.3-3.9-.5-5.9l18.7-17.5c.9-.9%201.6-1.9%202-3.1s.5-2.5.2-3.7-.8-2.4-1.6-3.3-1.8-1.7-3-2.1l-24-9c-.5-1.9-1.1-3.8-1.7-5.6l15-20.8c.7-1%201.2-2.2%201.3-3.4s0-2.5-.5-3.7-1.2-2.2-2.2-2.9-2.1-1.3-3.4-1.5l-25.4-4.2c-.9-1.7-1.8-3.4-2.7-5.2l10.7-23.4c.5-1.1.7-2.4.6-3.6s-.5-2.4-1.2-3.5-1.6-1.9-2.8-2.5-2.4-.8-3.6-.8l-25.8.9c-1.2-1.5-2.4-2.9-3.6-4.4l5.8-25.3c.3-1.2.3-2.5-.1-3.7s-1-2.3-1.9-3.2-2-1.5-3.2-1.9-2.5-.4-3.7-.1l-25.1%206c-1.4-1.2-2.9-2.4-4.4-3.6l.9-25.8c.1-1.3-.2-2.5-.8-3.6s-1.4-2.1-2.5-2.8-2.2-1.1-3.5-1.2-2.5.1-3.7.6l-23.3%2010.7-5.1-2.7-4.2-25.4c-.2-1.2-.7-2.4-1.5-3.4s-1.8-1.7-2.9-2.2-2.4-.7-3.7-.5-2.4.6-3.4%201.3l-20.9%2015c-1.9-.6-3.8-1.1-5.6-1.7l-9-24c-.4-1.2-1.2-2.2-2.1-3S307.2%205.2%20306%205s-2.5-.2-3.7.2-2.3%201.1-3.1%202l-17.6%2018.7c-2-.2-3.9-.4-5.9-.5L262.3%203.5c-.7-1.1-1.6-1.9-2.7-2.6S257.3%200%20256%200s-2.5.3-3.6.9-2%201.5-2.7%202.6l-13.5%2021.8c-2%20.2-3.9.3-5.9.6L212.9%207.1c-.9-.9-1.9-1.6-3.1-2s-2.5-.5-3.7-.2-2.4.8-3.3%201.6-1.7%201.8-2.1%203l-9%2024c-1.9.6-3.8%201.1-5.7%201.7l-20.8-15c-1-.7-2.2-1.2-3.4-1.3s-2.5%200-3.7.5-2.2%201.2-2.9%202.2-1.3%202.1-1.5%203.4l-4.2%2025.4c-1.7.9-3.4%201.8-5.2%202.7l-23.4-10.5c-1.1-.5-2.4-.7-3.7-.6s-2.5.5-3.5%201.2-1.9%201.7-2.5%202.8-.8%202.4-.8%203.6l.9%2025.8c-1.5%201.2-3%202.4-4.4%203.6l-25.1-6c-1.2-.3-2.5-.3-3.7.1s-2.3%201-3.2%201.9-1.5%202-1.9%203.2-.4%202.5-.1%203.7l6%2025.1c-1.2%201.4-2.4%202.9-3.6%204.4l-25.8-.9c-1.3%200-2.5.2-3.6.8s-2.1%201.4-2.8%202.4-1.1%202.2-1.2%203.5.1%202.5.6%203.6l10.7%2023.4c-.9%201.7-1.8%203.4-2.7%205.2l-25.4%204.1c-1.2.2-2.4.7-3.4%201.5s-1.7%201.8-2.2%202.9-.7%202.4-.5%203.7.6%202.4%201.3%203.4l15%2020.8c-.6%201.9-1.1%203.8-1.7%205.7l-24%209c-1.2.4-2.2%201.2-3%202.1s-1.4%202.1-1.6%203.3-.2%202.5.2%203.7%201.1%202.3%202%203.1l18.7%2017.5c-.2%202-.4%203.9-.6%205.9L3.5%20249.8c-1.1.7-1.9%201.6-2.6%202.7s-.9%202.3-.9%203.6.3%202.5.9%203.6%201.5%202%202.6%202.7l21.8%2013.5c.2%202%20.3%203.9.6%205.9L7.1%20299.1c-.9.9-1.6%201.9-2%203.1s-.5%202.5-.2%203.7.8%202.4%201.6%203.3%201.8%201.7%203%202.1l24%209c.6%201.9%201.1%203.8%201.7%205.6l-15%2020.8c-.7%201-1.2%202.2-1.3%203.4s0%202.5.5%203.7%201.2%202.2%202.2%202.9%202.1%201.3%203.4%201.5l25.4%204.2%202.7%205.1-10.5%2023.6c-.5%201.1-.7%202.4-.6%203.6s.5%202.5%201.2%203.5c.7%201.1%201.6%201.9%202.7%202.5s2.4.8%203.6.8l25.8-.9c1.2%201.5%202.4%202.9%203.6%204.4L73%20430.2c-.3%201.2-.3%202.5.1%203.7s1%202.3%201.9%203.2%202%201.5%203.2%201.9%202.5.4%203.7.1l25.2-5.9c1.5%201.2%202.9%202.4%204.4%203.6l-.9%2025.8c0%201.3.2%202.5.8%203.6s1.4%202.1%202.5%202.8%202.2%201.1%203.5%201.2%202.5-.1%203.6-.6l23.4-10.7%205.1%202.7%204.2%2025.4c.2%201.2.7%202.4%201.5%203.4s1.8%201.8%202.9%202.2%202.4.7%203.7.5%202.4-.6%203.4-1.3l20.8-15c1.9.6%203.8%201.1%205.6%201.7l9%2024c.4%201.2%201.2%202.2%202.1%203s2.1%201.4%203.3%201.6%202.5.2%203.7-.2%202.3-1.1%203.1-2l17.5-18.7c2%20.2%203.9.4%205.9.6l13.5%2021.8c.7%201.1%201.6%201.9%202.7%202.6s2.3.9%203.6.9%202.5-.3%203.6-.9%202-1.5%202.7-2.6l13.5-21.8c2-.2%203.9-.3%205.9-.6l17.5%2018.7c.9.9%201.9%201.6%203.1%202s2.5.5%203.7.2%202.4-.8%203.3-1.6%201.7-1.8%202.1-3l9-24c1.9-.6%203.8-1.1%205.6-1.7l20.8%2015c1%20.7%202.2%201.2%203.4%201.3s2.5%200%203.7-.5%202.2-1.2%202.9-2.2%201.3-2.1%201.5-3.4l4.2-25.4%205.1-2.7%2023.4%2010.7c1.1.5%202.4.7%203.6.6s2.4-.5%203.5-1.2%201.9-1.6%202.5-2.8.8-2.4.8-3.6l-.9-25.8c1.5-1.2%202.9-2.4%204.4-3.6l25.2%205.9c1.2.3%202.5.3%203.7-.1s2.3-1%203.2-1.9%201.5-2%201.9-3.2.4-2.5.1-3.7l-5.9-25.2c1.2-1.4%202.4-2.9%203.6-4.4l25.8.9c1.3.1%202.5-.2%203.6-.8s2.1-1.4%202.8-2.5c.7-1%201.1-2.2%201.2-3.5s-.1-2.5-.6-3.6l-10.7-23.4%202.7-5.1%2025.4-4.2c1.2-.2%202.4-.7%203.4-1.5s1.8-1.8%202.2-2.9.7-2.4.5-3.7-.6-2.4-1.3-3.4l-15-20.8c.6-1.9%201.1-3.8%201.7-5.6l24-9c1.2-.4%202.2-1.2%203-2.1s1.4-2.1%201.6-3.3.2-2.5-.2-3.7-1.1-2.3-2-3.1l-18.7-17.5c.2-1.9.4-3.9.6-5.9l21.8-13.5c1.1-.7%201.9-1.6%202.6-2.7s.9-2.3.9-3.6-.3-2.5-.9-3.6-1.5-2-2.6-2.7m-151%20129.1c-3.6-.8-7.4-.1-10.5%201.9s-5.3%205.2-6%208.8l-7.6%2035.7c-24.6%2011.1-51.3%2016.8-78.3%2016.7s-53.6-6.1-78.1-17.4l-7.6-35.7c-.4-1.8-1.1-3.5-2.1-5s-2.4-2.8-3.9-3.8-3.2-1.7-5-2-3.6-.3-5.4.1l-31.5%206.8c-5.8-6-11.3-12.5-16.3-19.2h153.2c1.7%200%202.9-.3%202.9-1.9v-54.2c0-1.6-1.2-1.9-2.9-1.9h-44.8v-34.4h48.5c4.4%200%2023.7%201.3%2029.8%2025.9%201.9%207.5%206.2%2032.1%209.1%2040%202.9%208.8%2014.6%2026.5%2027.1%2026.5h79c-5.3%207.1-11.1%2013.8-17.3%2020.1l-32.1-6.9zm25.8%2034.5c0%203-.9%206-2.6%208.5s-4%204.5-6.8%205.6-5.8%201.5-8.8.9-5.7-2-7.8-4.2-3.6-4.8-4.2-7.8-.3-6%20.8-8.8%203.1-5.2%205.6-6.9%205.4-2.6%208.5-2.6h.4c4%20.1%207.7%201.8%2010.5%204.6s4.3%206.7%204.3%2010.6h.1zm-225.6-.7c0%203-.9%206-2.6%208.5s-4.1%204.5-6.8%205.6-5.8%201.5-8.8.9-5.7-2-7.8-4.2-3.6-4.8-4.2-7.8-.3-6%20.9-8.8%203.1-5.2%205.6-6.8%205.4-2.6%208.5-2.6h.5c4%20.1%207.7%201.8%2010.5%204.6s4.3%206.7%204.3%2010.6h.1zM69.6%20234.2l32.8-14.6c1.7-.7%203.2-1.8%204.4-3.1s2.2-2.9%202.9-4.6%201-3.5.9-5.3-.5-3.6-1.2-5.3l-6.8-15.2h26.6v119.7H75.6c-6.6-23.2-8.7-47.6-6.1-71.6zm-11.3-36.1c0-2%20.4-4%201.2-5.8s1.9-3.5%203.3-4.9%203.1-2.5%204.9-3.3%203.8-1.2%205.8-1.2h.5c3%20.1%205.9%201%208.3%202.8s4.3%204.1%205.4%206.9%201.3%205.8.7%208.8-2.1%205.6-4.3%207.7-4.9%203.5-7.8%204.1-6%20.2-8.7-.9-5.1-3.1-6.8-5.6-2.5-5.4-2.5-8.4zm155.2%2024.5v-35.3h63.3c3.3%200%2023.1%203.8%2023.1%2018.6%200%2012.3-15.2%2016.7-27.7%2016.7zM399%20306.7c-9.8%201.1-20.6-4.1-22-10.1-5.8-32.5-15.4-39.4-30.6-51.4%2018.9-12%2038.5-29.6%2038.5-53.3%200-25.5-17.5-41.6-29.4-49.5-16.8-11-35.3-13.2-40.3-13.2H116.3c27.5-30.7%2064.4-51.5%20104.9-59.2l23.5%2024.6c1.3%201.3%202.8%202.4%204.4%203.1s3.5%201.1%205.3%201.2%203.6-.3%205.3-.9%203.2-1.7%204.6-2.9l26.3-25c26.8%205%2052.1%2015.8%2074.3%2031.6s40.6%2036.2%2054.1%2059.9l-18%2040.6c-1.5%203.4-1.5%207.2-.2%2010.6s3.9%206.2%207.3%207.7l34.6%2015.3c1.1%2010.8%201.2%2021.7.4%2032.5h-19.3c-1.9%200-2.7%201.3-2.7%203.1v8.8c0%2020.8-11.7%2025.3-22%2026.5zM240%2060.2c0-4%201.6-7.9%204.5-10.7s6.7-4.5%2010.7-4.5h.4c3%20.1%205.9%201%208.4%202.8s4.3%204.1%205.4%206.9%201.3%205.8.7%208.8-2.1%205.6-4.3%207.7-4.9%203.5-7.8%204-6%20.2-8.7-.9-5.1-3.1-6.8-5.6-2.5-5.4-2.5-8.4zM436.8%20214c-2%200-4-.4-5.8-1.2s-3.5-1.9-4.9-3.3-2.5-3.1-3.3-4.9-1.2-3.8-1.2-5.8.4-4%201.2-5.8%201.9-3.5%203.3-4.9%203.1-2.5%204.9-3.3%203.8-1.2%205.8-1.2h.4c4%20.1%207.9%201.7%2010.7%204.6s4.4%206.8%204.3%2010.8-1.7%207.9-4.6%2010.7-6.8%204.4-10.8%204.3%22/%3E%3C/svg%3E');}.md-tag.md-tag--pytorch{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12.005%200%204.952%207.053a9.865%209.865%200%200%200%200%2014.022%209.866%209.866%200%200%200%2014.022%200c3.984-3.9%203.986-10.205.085-14.023l-1.744%201.743c2.904%202.905%202.904%207.634%200%2010.538s-7.634%202.904-10.538%200-2.904-7.634%200-10.538l4.647-4.646.582-.665zm3.568%203.899a1.327%201.327%200%200%200-1.327%201.327%201.327%201.327%200%200%200%201.327%201.328A1.327%201.327%200%200%200%2016.9%205.226%201.327%201.327%200%200%200%2015.573%203.9z%22/%3E%3C/svg%3E');}.md-tag.md-tag--quant{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M18.08%2017.8c-.46.13-.87.2-1.23.2-1.2%200-2.01-.88-2.42-2.65h-.05c-.99%201.91-2.38%202.86-4.13%202.86-1.31%200-2.36-.49-3.15-1.48S5.92%2014.5%205.92%2013c0-1.75.45-3.15%201.34-4.24s2.1-1.64%203.63-1.64c.82%200%201.56.23%202.2.68.64.46%201.13%201.1%201.47%201.93h.04l.71-2.4h2.56l-2.14%205.32c.24%201.24.49%202.09.77%202.54.24.45.58.68%201%20.68.24%200%20.43-.04.6-.11zm-4.26-5.24c-.21-1.13-.55-2.01-1.01-2.61-.45-.61-1-.91-1.63-.91-.82%200-1.48.37-1.97%201.1-.49.74-.71%201.65-.71%202.72%200%20.98.19%201.79.62%202.45.42.66.99.98%201.7.98.6%200%201.15-.29%201.64-.84.5-.57.91-1.4%201.24-2.49z%22/%3E%3C/svg%3E');}.md-tag.md-tag--stats{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M19%203H5c-1.1%200-2%20.9-2%202v14c0%201.1.9%202%202%202h14c1.1%200%202-.9%202-2V5c0-1.1-.9-2-2-2m-6%204.1L14.1%206l1.4%201.4L16.9%206%2018%207.1l-1.4%201.4L18%209.9%2016.9%2011l-1.4-1.4-1.4%201.4L13%209.9l1.4-1.4zm-6.8.6h5v1.5h-5zm5.3%208.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2zm6.5%201.2h-5v-1.5h5zm0-2.4h-5v-1.5h5z%22/%3E%3C/svg%3E');}.md-tag.md-tag--visulization{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M22%2021H2V3h2v16h2v-9h4v9h2V6h4v13h2v-5h4z%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#基于-bert-的中文问答机器人" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "fkujvevd2q");
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1438193177826254" crossorigin="anonymous"></script>
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jeremy Feng&#39;s Blog" class="md-header__button md-logo" aria-label="Jeremy Feng's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M277.8 8.6c-12.3-11.4-31.3-11.4-43.5 0l-224 208c-9.6 9-12.8 22.9-8 35.1S18.8 272 32 272h16v176c0 35.3 28.7 64 64 64h288c35.3 0 64-28.7 64-64V272h16c13.2 0 25-8.1 29.8-20.3s1.6-26.2-8-35.1zM240 320h32c26.5 0 48 21.5 48 48v96H192v-96c0-26.5 21.5-48 48-48"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jeremy Feng's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              基于 Bert 的中文问答机器人
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="跟随系统"  type="radio" name="__palette" id="__palette_0">
          
            <label class="md-header__button md-icon" title="跟随系统" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="日间模式"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="日间模式" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="夜间模式"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="夜间模式" for="__palette_0" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
            </label>
          
        
      </form>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="按 F 或 S 搜索" placeholder="按 F 或 S 搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../code/" class="md-tabs__link">
          
  
  
    
  
  代码

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../workflow/" class="md-tabs__link">
          
  
  
    
  
  效率

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../tags/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://v.fengchao.pro" class="md-tabs__link" target="_blank" rel="noopener">
        
  
  
    
  
  问答

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../about/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jeremy Feng&#39;s Blog" class="md-nav__button md-logo" aria-label="Jeremy Feng's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M277.8 8.6c-12.3-11.4-31.3-11.4-43.5 0l-224 208c-9.6 9-12.8 22.9-8 35.1S18.8 272 32 272h16v176c0 35.3 28.7 64 64 64h288c35.3 0 64-28.7 64-64V272h16c13.2 0 25-8.1 29.8-20.3s1.6-26.2-8-35.1zM240 320h32c26.5 0 48 21.5 48 48v96H192v-96c0-26.5 21.5-48 48-48"/></svg>

    </a>
    Jeremy Feng's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    博客
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    博客
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    归档
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2025 年
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2024 年
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2023 年
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2022 年
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    标签
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    标签
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/computer-science/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Computer Science
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/indiedev/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      IndieDev
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/llm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      LLM
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/latex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      LaTeX
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/leetcode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      LeetCode
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Linux
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/pytorch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      PyTorch
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Python
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/rust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Rust
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      数据可视化
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      数据库
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      机器学习
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      深度学习
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E7%94%9F%E6%B4%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      生活
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E7%BB%9F%E8%AE%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      统计
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E8%BF%90%E7%AD%B9%E5%AD%A6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      运筹学
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E9%87%8F%E5%8C%96%E7%A0%94%E7%A9%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      量化研究
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../code/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    代码
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    代码
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/pandas/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.922 0h2.623v18.104h-2.623zm-4.126 12.94h2.623v2.57h-2.623zm0-7.037h2.623v5.446h-2.623zm0 11.197h2.623v5.446h-2.623zM4.456 5.896h2.622V24H4.455zm4.213 2.559h2.623v2.57H8.67zm0 4.151h2.623v5.447H8.67zm0-11.187h2.623v5.446H8.67Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Pandas 数据框
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/numpy/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10.315 4.876-4.01-2.024-4.401 2.196 4.118 2.068zm1.838.928 4.205 2.122-4.363 2.19L7.87 8.046zm5.615-2.922 4.32 2.166-3.863 1.94-4.213-2.125zM15.91 1.95 12.021 0 8.174 1.92l4.007 2.02zm-3.04 16.744V24l4.711-2.35-.005-5.31zm4.704-4.206-.005-5.253-4.699 2.336v5.254zm5.655-.984v5.327l-4.018 2.005-.002-5.303zm0-1.863v-5.22l-4.025 2.001.003 5.264zm-12.022-.07L8.033 9.976v6.895s-3.88-8.257-4.24-8.998c-.046-.096-.237-.201-.285-.227A358 358 0 0 0 .773 6.25V18.43l2.82 1.508V13.57s3.84 7.378 3.878 7.458c.04.08.425.858.837 1.132.548.363 2.899 1.776 2.899 1.776z"/></svg>
  
  <span class="md-ellipsis">
    
  
    NumPy 数组
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/list/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 4v2h3v12h-3v2h5V4M4 4v16h5v-2H6V6h3V4z"/></svg>
  
  <span class="md-ellipsis">
    
  
    List 列表
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/loop/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 4a8 8 0 1 1-8 8 8 8 0 0 1 8-8M3 12a6 6 0 0 0 4 5.65v2.09A8 8 0 0 1 7 4.26v2.09A6 6 0 0 0 3 12"/></svg>
  
  <span class="md-ellipsis">
    
  
    Loop 循环
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/plot/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.75 20.85c1.78-.7 1.39-2.63.49-3.85-.89-1.25-2.12-2.11-3.36-2.94A9.8 9.8 0 0 1 4.54 12c-.28-.33-.85-.94-.27-1.06.59-.12 1.61.46 2.13.68.91.38 1.81.82 2.65 1.34l1.01-1.7C8.5 10.23 6.5 9.32 4.64 9.05c-1.06-.16-2.18.06-2.54 1.21-.32.99.19 1.99.77 2.77 1.37 1.83 3.5 2.71 5.09 4.29.34.33.75.72.95 1.18.21.44.16.47-.31.47-1.24 0-2.79-.97-3.8-1.61l-1.01 1.7c1.53.94 4.09 2.41 5.96 1.79m11.09-15.6c.22-.22.22-.58 0-.79l-1.3-1.3a.56.56 0 0 0-.78 0l-1.02 1.02 2.08 2.08M11 10.92V13h2.08l6.15-6.15-2.08-2.08z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Plot 绘图
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/print/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 3H6v4h12m1 5a1 1 0 0 1-1-1 1 1 0 0 1 1-1 1 1 0 0 1 1 1 1 1 0 0 1-1 1m-3 7H8v-5h8m3-6H5a3 3 0 0 0-3 3v6h4v4h12v-4h4v-6a3 3 0 0 0-3-3"/></svg>
  
  <span class="md-ellipsis">
    
  
    Print 打印
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/machine-learning/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M22.7 33.4c13.5-4.1 28.1 1.1 35.9 12.9l165.4 248 165.4-248c7.8-11.7 22.4-17 35.9-12.9S448 49.9 448 64v384c0 17.7-14.3 32-32 32s-32-14.3-32-32V169.7L250.6 369.8c-5.9 8.9-15.9 14.2-26.6 14.2s-20.7-5.3-26.6-14.2L64 169.7V448c0 17.7-14.3 32-32 32S0 465.7 0 448V64c0-14.1 9.2-26.5 22.7-30.6"/></svg>
  
  <span class="md-ellipsis">
    
  
    Machine Learning 机器学习
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/sql/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4"/></svg>
  
  <span class="md-ellipsis">
    
  
    SQL 数据库
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/r/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M578.5 226.6C578.5 119.1 448.4 32 288 32S-2.5 119.1-2.5 226.6c0 95.8 103.3 175.4 239.4 191.5V480H336v-61.5c24.3-2.7 47.6-7.4 69.4-13.9l40.1 75.4h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7m-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9m225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3m-.9 72.5h26.6c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9z"/></svg>
  
  <span class="md-ellipsis">
    
  
    R 语言
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/others/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M195.1 9.5c3-14.8 16.1-25.5 31.3-25.5h59.8c15.2 0 28.3 10.7 31.3 25.5l14.5 70c14.1 6 27.3 13.7 39.3 22.8l67.8-22.5c14.4-4.8 30.2 1.2 37.8 14.4l29.9 51.8c7.6 13.2 4.9 29.8-6.5 39.9L447 233.3c.9 7.4 1.3 15 1.3 22.7s-.5 15.3-1.3 22.7l53.4 47.5c11.4 10.1 14 26.8 6.5 39.9L477 417.9c-7.6 13.1-23.4 19.2-37.8 14.4l-67.8-22.5c-12.1 9.1-25.3 16.7-39.3 22.8l-14.4 69.9c-3.1 14.9-16.2 25.5-31.3 25.5h-59.8c-15.2 0-28.3-10.7-31.3-25.5l-14.4-69.9c-14.1-6-27.2-13.7-39.3-22.8l-68.1 22.5c-14.4 4.8-30.2-1.2-37.8-14.4L5.8 366.1c-7.6-13.2-4.9-29.8 6.5-39.9l53.4-47.5c-.9-7.4-1.3-15-1.3-22.7s.5-15.3 1.3-22.7l-53.4-47.5C.9 175.7-1.7 159 5.8 145.9l29.9-51.8c7.6-13.2 23.4-19.2 37.8-14.4l67.8 22.5c12.1-9.1 25.3-16.7 39.3-22.8zM256.3 336a80 80 0 1 0-.6-160 80 80 0 1 0 .6 160"/></svg>
  
  <span class="md-ellipsis">
    
  
    Others 其他
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../workflow/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    效率
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    效率
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/quant/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.08 17.8c-.46.13-.87.2-1.23.2-1.2 0-2.01-.88-2.42-2.65h-.05c-.99 1.91-2.38 2.86-4.13 2.86-1.31 0-2.36-.49-3.15-1.48S5.92 14.5 5.92 13c0-1.75.45-3.15 1.34-4.24s2.1-1.64 3.63-1.64c.82 0 1.56.23 2.2.68.64.46 1.13 1.1 1.47 1.93h.04l.71-2.4h2.56l-2.14 5.32c.24 1.24.49 2.09.77 2.54.24.45.58.68 1 .68.24 0 .43-.04.6-.11zm-4.26-5.24c-.21-1.13-.55-2.01-1.01-2.61-.45-.61-1-.91-1.63-.91-.82 0-1.48.37-1.97 1.1-.49.74-.71 1.65-.71 2.72 0 .98.19 1.79.62 2.45.42.66.99.98 1.7.98.6 0 1.15-.29 1.64-.84.5-.57.91-1.4 1.24-2.49z"/></svg>
  
  <span class="md-ellipsis">
    
  
    量化研究
  

    
  </span>
  
    
  
  
    <span class="md-status md-status--encrypted"></span>
  

  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/writing/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-1.9l10-10V8l-6-6zm7 1.5L18.5 9H13zm7.1 9.5c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-2 1.8L12 20.9V23h2.1l6.1-6.1z"/></svg>
  
  <span class="md-ellipsis">
    
  
    写作
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/tools/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.71 20.29-1.42 1.42a1 1 0 0 1-1.41 0L7 9.85A3.8 3.8 0 0 1 6 10a4 4 0 0 1-3.78-5.3l2.54 2.54.53-.53 1.42-1.42.53-.53L4.7 2.22A4 4 0 0 1 10 6a3.8 3.8 0 0 1-.15 1l11.86 11.88a1 1 0 0 1 0 1.41M2.29 18.88a1 1 0 0 0 0 1.41l1.42 1.42a1 1 0 0 0 1.41 0l5.47-5.46-2.83-2.83M20 2l-4 2v2l-2.17 2.17 2 2L18 8h2l2-4Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    工具
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    标签
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://v.fengchao.pro" class="md-nav__link" target="_blank" rel="noopener">
        
  
  
  <span class="md-ellipsis">
    
  
    问答
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../about/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    关于
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    关于
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/en/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#导入包" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          导入包
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#设置在-gpu-上训练" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          设置在 GPU 上训练
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#固定随机种子" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          固定随机种子
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#读取本地-json-数据" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          读取本地 Json 数据
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#导入预训练的分词模型和问答模型" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          导入预训练的分词模型和问答模型
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="导入预训练的分词模型和问答模型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#安装-transformers-库" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          安装 <code>transformers</code> 库
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#导入预训练分词模型" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          导入预训练分词模型
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#导入预训练问答模型" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          导入预训练问答模型
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用多块-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          使用多块 GPU
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#准备训练数据" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          准备训练数据
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#对-paragraphs-和-questions-进行-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          对 paragraphs 和 questions 进行 Encoding
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="对 paragraphs 和 questions 进行 Encoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          <code>input_ids</code>
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token_type_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          <code>token_type_ids</code>
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attention_mask" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          <code>attention_mask</code>
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#查看-input_idstoken_type_ids-和-attention_mask-的维度" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          查看 <code>input_ids</code>、<code>token_type_ids</code> 和 <code>attention_mask</code> 的维度：
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#将-answer-在原始-paragrapgh-的起止索引转换为在经过-tokenizor-之后的-input_ids-中的起止索引" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          将 answer 在原始 paragrapgh 的起止索引，转换为：在经过 tokenizor 之后的 input_ids 中的起止索引
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#加载训练数据" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          加载训练数据
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#指定-optimizer-为-adamw" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          指定 optimizer 为 AdamW
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#加速训练" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          加速训练
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#训练模型" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          训练模型
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="训练模型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#测试一下训练-1-个-batch-时究竟在做什么" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          测试一下，训练 1 个 batch 时究竟在做什么
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#用所有数据训练模型" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          用所有数据训练模型
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#将训练好的模型保存到本地" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          将训练好的模型保存到本地
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#读取本地训练好的模型" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          读取本地训练好的模型
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#在新的数据集上进行预测最激动人心的部分" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          在新的数据集上进行预测（最激动人心的部分）
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="在新的数据集上进行预测（最激动人心的部分）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#在-dev-数据上进行检验" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          在 dev 数据上进行检验：
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#自定义数据进行检验" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          自定义数据进行检验
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#开放式问题" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          开放式问题
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="开放式问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bert-固定长度的解决方案" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Bert 固定长度的解决方案
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#预测-start_pred-和-end_pred-的位置不合理的解决方案" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          预测 start_pred 和 end_pred 的位置不合理的解决方案
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bert-的分词方式" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Bert 的分词方式
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#总结" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          总结
        </span>
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    回到首页
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="/blog/avatar.jpg" alt="冯超">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          冯超
                        
                      </strong>
                      <br>
                      Jeremy Feng
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                     
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2023-04-18 00:00:00+00:00" class="md-ellipsis">2023年4月18日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                             
                            
                              <a href="../category/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a>, 
                              <a href="../category/pytorch/">PyTorch</a>, 
                              <a href="../category/llm/">LLM</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              阅读时间 25 分钟
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
              <ul class="md-post__meta md-nav__list">
                <li class="md-nav__item md-nav__item--section">
                  <div class="md-post__title">
                    <span class="md-ellipsis">
                      相关链接
                    </span>
                  </div>
                  <nav class="md-nav">
                    <ul class="md-nav__list">
                      
                        
                        
  
  
  
  
    <li class="md-nav__item">
      <a href="https://huggingface.co/spaces/JeremyFeng/chinese-question-answering" class="md-nav__link" target="_blank" rel="noopener">
        
  
  
  <span class="md-ellipsis">
    
  
    在线体验
  

    
  </span>
  
  

      </a>
    </li>
  

                      
                        
                        
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/jeremy-feng/deep-learning-coursework/tree/main/2-BERT" class="md-nav__link" target="_blank" rel="noopener">
        
  
  
  <span class="md-ellipsis">
    
  
    本文代码
  

    
  </span>
  
  

      </a>
    </li>
  

                      
                        
                        
  
  
  
  
    <li class="md-nav__item">
      <a href="https://huggingface.co/bert-base-chinese" class="md-nav__link" target="_blank" rel="noopener">
        
  
  
  <span class="md-ellipsis">
    
  
    huggingface bert-base-chinese 模型
  

    
  </span>
  
  

      </a>
    </li>
  

                      
                        
                        
  
  
  
  
    <li class="md-nav__item">
      <a href="https://huggingface.co/course/zh-CN/chapter2/4" class="md-nav__link" target="_blank" rel="noopener">
        
  
  
  <span class="md-ellipsis">
    
  
    标记器（Tokenizer）
  

    
  </span>
  
  

      </a>
    </li>
  

                      
                        
                        
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.bilibili.com/video/BV1pu411o7BE" class="md-nav__link" target="_blank" rel="noopener">
        
  
  
  <span class="md-ellipsis">
    
  
    Transformer 论文逐段精读【论文精读】
  

    
  </span>
  
  

      </a>
    </li>
  

                      
                        
                        
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.bilibili.com/video/BV1PL411M7eQ" class="md-nav__link" target="_blank" rel="noopener">
        
  
  
  <span class="md-ellipsis">
    
  
    BERT 论文逐段精读【论文精读】
  

    
  </span>
  
  

      </a>
    </li>
  

                      
                    </ul>
                  </nav>
                </li>
              </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
        
        
          
        
      
      
        <a href="../tags/#tag:llm" class="md-tag md-tag-icon md-tag--llm">LLM</a>
      
    
      
      
      
        
        
          
        
      
      
        <a href="../tags/#tag:pytorch" class="md-tag md-tag-icon md-tag--pytorch">PyTorch</a>
      
    
      
      
      
        
        
          
        
      
      
        <a href="../tags/#tag:深度学习" class="md-tag md-tag-icon md-tag--dl">深度学习</a>
      
    
  </nav>


  
    <a href="https://github.com/jeremy-feng/blog/edit/master/docs/blog/posts/2023-04-18-bert-qa/index.md" title="Edit this page" class="md-content__button md-icon" rel="edit noopener" target="_blank">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="基于-bert-的中文问答机器人">基于 Bert 的中文问答机器人<a class="headerlink" href="#基于-bert-的中文问答机器人" title="定位到这">&para;</a></h1>
<p>最终训练的模型已经部署到 <a href="https://huggingface.co/spaces/JeremyFeng/chinese-question-answering" target="_blank" rel="noopener">Hugging Face</a>，请尝试输入一些简单的中文段落和相关问题 <img alt="🌝" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f31d.svg" title=":full_moon_with_face:"></p>
<p><iframe
    src="https://jeremyfeng-chinese-question-answering.hf.space"
    frameborder="0"
    width="850"
    height="650"
></iframe>
</p>
<p>本文基于 Bert 的中文分词和问答的预训练模型，利用 10, 000 余条中文问答数据进行微调，构建了能够理解中文段落并回答相关问题的问答机器人。用自定义的数据进行测试，模型的效果基本能达到“正确回答小学三年级以下的阅读理解题”的水平。</p>
<p><img alt="predict-james" src="../2023-04-18-bert-qa/index-image/predict-james.png" /></p>
<p>这是我第一次完整地实现一个 NLP 项目。在这个过程中，我学习了如何使用预训练模型、中文分词、准备数据、文本编码与解码、设计问答机器的损失与优化目标、导出训练模型等技术，对问答领域的 NLP 有了更透彻的理解。</p>
<p>理论部分可参考李沐老师的 <a href="https://www.bilibili.com/video/BV1pu411o7BE" target="_blank" rel="noopener">Transformer 论文逐段精读【论文精读】</a> 和 <a href="https://www.bilibili.com/video/BV1PL411M7eQ" target="_blank" rel="noopener">BERT 论文逐段精读【论文精读】</a>。当然，如果想要理解得更透彻一些，还是应该动手写代码，看看每一步到底在做什么，到真正实现出来看到模型结果的那一刻，是非常有成就感的。</p>
<div class="admonition abstract">
<p class="admonition-title">不同 GPU 平台的训练效率对比</p>
<p>为对比不同平台上的 GPU 的训练效率的差异，我在 Kaggle、Google Colab、趋动云和本地的 Macbook Pro M1 Pro 四台机器上分别进行了训练。对于单个 Epoch：</p>
<ol>
<li>付费使用的趋动云使用 2 个 GPU 并行训练，效率最高，单个 Epoch 共耗时 4 分 40 秒；</li>
<li>免费使用的 Kaggle 耗时 9 分钟，Google Colab 耗时 17 分钟；</li>
<li>在 Macbook Pro M1 Pro 上运行效率最低，即使使用了 GPU，单个 Epoch 仍预计耗时 3 小时。</li>
</ol>
</div>
<!-- more -->

<h2 id="导入包">导入包<a class="headerlink" href="#导入包" title="定位到这">&para;</a></h2>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.autonotebook</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</code></pre></div>
<h2 id="设置在-gpu-上训练">设置在 GPU 上训练<a class="headerlink" href="#设置在-gpu-上训练" title="定位到这">&para;</a></h2>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
</code></pre></div>
<h2 id="固定随机种子">固定随机种子<a class="headerlink" href="#固定随机种子" title="定位到这">&para;</a></h2>
<p>训练过程有很多随机性，为了结果的可复现性，可以用一个函数固定住所有随机种子。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">same_seeds</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="5 "></span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos="9 "></span></a>    <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">same_seeds</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<h2 id="读取本地-json-数据">读取本地 Json 数据<a class="headerlink" href="#读取本地-json-数据" title="定位到这">&para;</a></h2>
<p>本项目不涉及超参数的调整，因此只读取 <code>tarin.json</code> 作为训练数据，并用 <code>dev.json</code> 观察样本外的问答结果。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./input/cmrc2018/train.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">train</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos="4 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./input/cmrc2018/dev.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">dev</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div>
<h2 id="导入预训练的分词模型和问答模型">导入预训练的分词模型和问答模型<a class="headerlink" href="#导入预训练的分词模型和问答模型" title="定位到这">&para;</a></h2>
<h3 id="安装-transformers-库">安装 <code>transformers</code> 库<a class="headerlink" href="#安装-transformers-库" title="定位到这">&para;</a></h3>
<p><a href="https://huggingface.co/models" target="_blank" rel="noopener">huggingface</a> 提供了许多预训练模型，可以通过 <code>transformers</code> 库导入它们。</p>
<p>如果没有安装 <code>transformers</code> 库，可以安装它。</p>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos="1 "></span></a>import importlib
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos="3 "></span></a>try:
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos="4 "></span></a>    importlib.import_module(&quot;transformers&quot;)
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos="5 "></span></a>    print(&quot;transformers exists.&quot;)
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos="6 "></span></a>except ImportError:
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos="7 "></span></a>    ! pip install transformers
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><a href="#__codelineno-5-8"><span class="linenos" data-linenos="8 "></span></a>    print(&quot;transformers installed.&quot;)
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>transformers exists.
</code></pre></div>
<p>我们需要用 <code>BertTokenizerFast</code> 导入分词模型，用 <code>BertForQuestionAnswering</code> 导入问答模型。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">BertTokenizerFast</span><span class="p">,</span> <span class="n">BertForQuestionAnswering</span>
</code></pre></div>
<h3 id="导入预训练分词模型">导入预训练分词模型<a class="headerlink" href="#导入预训练分词模型" title="定位到这">&para;</a></h3>
<p><a href="https://huggingface.co/docs/transformers/model_doc/bert#transformers.BertTokenizerFast" target="_blank" rel="noopener"><code>BertTokenizerFast</code></a> 是 <a href="https://huggingface.co/docs/transformers/model_doc/bert#transformers.BertTokenizer" target="_blank" rel="noopener"><code>BertTokenizer</code></a> 的升级版，速度更快，性能更优。</p>
<p><code>bert-base-chinese</code> 是一个中文 BERT 预训练模型，可以将中文句子或文本数据转换为相应的 token，以便进行文本分类、序列标注等自然语言处理任务。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">BertTokenizerFast</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;./pre-trained-model/bert-base-chinese&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="导入预训练问答模型">导入预训练问答模型<a class="headerlink" href="#导入预训练问答模型" title="定位到这">&para;</a></h3>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">model</span> <span class="o">=</span> <span class="n">BertForQuestionAnswering</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="s2">&quot;./pre-trained-model/bert-base-chinese&quot;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1"># You can safely ignore the warning message (it pops up because new prediction heads for QA are initialized randomly)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>Some weights of the model checkpoint at ./pre-trained-model/bert-base-chinese were not used when initializing BertForQuestionAnswering: [&#39;cls.predictions.transform.LayerNorm.weight&#39;, &#39;cls.predictions.bias&#39;, &#39;cls.predictions.decoder.weight&#39;, &#39;cls.predictions.transform.dense.weight&#39;, &#39;cls.seq_relationship.bias&#39;, &#39;cls.predictions.transform.dense.bias&#39;, &#39;cls.seq_relationship.weight&#39;, &#39;cls.predictions.transform.LayerNorm.bias&#39;]
<span class="linenos" data-linenos="2 "></span>- This IS expected if you are initializing BertForQuestionAnswering from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
<span class="linenos" data-linenos="3 "></span>- This IS NOT expected if you are initializing BertForQuestionAnswering from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
<span class="linenos" data-linenos="4 "></span>Some weights of BertForQuestionAnswering were not initialized from the model checkpoint at ./pre-trained-model/bert-base-chinese and are newly initialized: [&#39;qa_outputs.bias&#39;, &#39;qa_outputs.weight&#39;]
<span class="linenos" data-linenos="5 "></span>You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
</code></pre></div>
<h2 id="使用多块-gpu">使用多块 GPU<a class="headerlink" href="#使用多块-gpu" title="定位到这">&para;</a></h2>
<p>在趋动云上可选择多块 GPU 的配置，但默认运行时只会使用一块 GPU，另一块 GPU 其实是空闲的。</p>
<p>在终端查看趋动云 GPU 使用状态：<code>orion-smi</code></p>
<p><img alt="one-gpu" src="../2023-04-18-bert-qa/index-image/one-gpu.png" /></p>
<p>为了使用多块 GPU，我们可以将 model 输入到 <code>nn.DataParallel</code> 中，使得加载训练数据时分别并行加载到各个 GPU 上进行计算。</p>
<div class="admonition tip">
<p class="admonition-title">多个 GPU 时需要将各 GPU 计算出的损失值转换为标量</p>
<p>需要注意的是，由于损失值是在多个 GPU 上进行计算的，因此后续训练得到的 <code>loss.out</code> 是一个向量，而不是一个标量。我们后续将用 <code>.mean()</code> 对多块 GPU 上的 loss 值求均值，将其转换为一个标量。</p>
</div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">torch.nn.parallel</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataParallel</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><a href="#__codelineno-9-4"><span class="linenos" data-linenos="4 "></span></a><span class="c1"># 将模型包装在 DataParallel 中</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><a href="#__codelineno-9-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">DataParallel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div>
<p>使用多块 GPU 训练时，两个 GPU 的使用情况如下：</p>
<p><img alt="two-gpu" src="../2023-04-18-bert-qa/index-image/two-gpu.png" /></p>
<h2 id="准备训练数据">准备训练数据<a class="headerlink" href="#准备训练数据" title="定位到这">&para;</a></h2>
<p>原始 Json 格式的数据相当于是一个数据字典，并不是可以直接输入到神经网络中的 <code>tensor</code> 格式，我们需要将其准备为数值型的 <code>tensor</code> 数据。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>[{&#39;paragraphs&#39;: [{&#39;id&#39;: &#39;TRAIN_186&#39;,
<span class="linenos" data-linenos=" 2 "></span>    &#39;context&#39;: &#39;范廷颂枢机（，），圣名保禄·若瑟（），是越南罗马天主教枢机。1963 年被任为主教；1990 年被擢升为天主教河内总教区宗座署理；1994 年被擢升为总主教，同年年底被擢升为枢机；2009 年 2 月离世。范廷颂于 1919 年 6 月 15 日在越南宁平省天主教发艳教区出生；童年时接受良好教育后，被一位越南神父带到河内继续其学业。范廷颂于 1940 年在河内大修道院完成神学学业。范廷颂于 1949 年 6 月 6 日在河内的主教座堂晋铎；及后被派到圣女小德兰孤儿院服务。1950 年代，范廷颂在河内堂区创建移民接待中心以收容到河内避战的难民。1954 年，法越战争结束，越南民主共和国建都河内，当时很多天主教神职人员逃至越南的南方，但范廷颂仍然留在河内。翌年管理圣若望小修院；惟在 1960 年因捍卫修院的自由、自治及拒绝政府在修院设政治课的要求而被捕。1963 年 4 月 5 日，教宗任命范廷颂为天主教北宁教区主教，同年 8 月 15 日就任；其牧铭为「我信天主的爱」。由于范廷颂被越南政府软禁差不多 30 年，因此他无法到所属堂区进行牧灵工作而专注研读等工作。范廷颂除了面对战争、贫困、被当局迫害天主教会等问题外，也秘密恢复修院、创建女修会团体等。1990 年，教宗若望保禄二世在同年 6 月 18 日擢升范廷颂为天主教河内总教区宗座署理以填补该教区总主教的空缺。1994 年 3 月 23 日，范廷颂被教宗若望保禄二世擢升为天主教河内总教区总主教并兼天主教谅山教区宗座署理；同年 11 月 26 日，若望保禄二世擢升范廷颂为枢机。范廷颂在 1995 年至 2001 年期间出任天主教越南主教团主席。2003 年 4 月 26 日，教宗若望保禄二世任命天主教谅山教区兼天主教高平教区吴光杰主教为天主教河内总教区署理主教；及至 2005 年 2 月 19 日，范廷颂因获批辞去总主教职务而荣休；吴光杰同日真除天主教河内总教区总主教职务。范廷颂于 2009 年 2 月 22 日清晨在河内离世，享年 89 岁；其葬礼于同月 26 日上午在天主教河内总教区总主教座堂举行。&#39;,
<span class="linenos" data-linenos=" 3 "></span>    &#39;qas&#39;: [{&#39;question&#39;: &#39;范廷颂是什么时候被任为主教的？&#39;,
<span class="linenos" data-linenos=" 4 "></span>      &#39;id&#39;: &#39;TRAIN_186_QUERY_0&#39;,
<span class="linenos" data-linenos=" 5 "></span>      &#39;answers&#39;: [{&#39;text&#39;: &#39;1963 年&#39;, &#39;answer_start&#39;: 30}]},
<span class="linenos" data-linenos=" 6 "></span>     {&#39;question&#39;: &#39;1990 年，范廷颂担任什么职务？&#39;,
<span class="linenos" data-linenos=" 7 "></span>      &#39;id&#39;: &#39;TRAIN_186_QUERY_1&#39;,
<span class="linenos" data-linenos=" 8 "></span>      &#39;answers&#39;: [{&#39;text&#39;: &#39;1990 年被擢升为天主教河内总教区宗座署理&#39;, &#39;answer_start&#39;: 41}]},
<span class="linenos" data-linenos=" 9 "></span>     {&#39;question&#39;: &#39;范廷颂是于何时何地出生的？&#39;,
<span class="linenos" data-linenos="10 "></span>      &#39;id&#39;: &#39;TRAIN_186_QUERY_2&#39;,
<span class="linenos" data-linenos="11 "></span>      &#39;answers&#39;: [{&#39;text&#39;: &#39;范廷颂于 1919 年 6 月 15 日在越南宁平省天主教发艳教区出生&#39;,
<span class="linenos" data-linenos="12 "></span>        &#39;answer_start&#39;: 97}]},
<span class="linenos" data-linenos="13 "></span>     {&#39;question&#39;: &#39;1994 年 3 月，范廷颂担任什么职务？&#39;,
<span class="linenos" data-linenos="14 "></span>      &#39;id&#39;: &#39;TRAIN_186_QUERY_3&#39;,
<span class="linenos" data-linenos="15 "></span>      &#39;answers&#39;: [{&#39;text&#39;: &#39;1994 年 3 月 23 日，范廷颂被教宗若望保禄二世擢升为天主教河内总教区总主教并兼天主教谅山教区宗座署理&#39;,
<span class="linenos" data-linenos="16 "></span>        &#39;answer_start&#39;: 548}]},
<span class="linenos" data-linenos="17 "></span>     {&#39;question&#39;: &#39;范廷颂是何时去世的？&#39;,
<span class="linenos" data-linenos="18 "></span>      &#39;id&#39;: &#39;TRAIN_186_QUERY_4&#39;,
<span class="linenos" data-linenos="19 "></span>      &#39;answers&#39;: [{&#39;text&#39;: &#39;范廷颂于 2009 年 2 月 22 日清晨在河内离世&#39;, &#39;answer_start&#39;: 759}]}]}],
<span class="linenos" data-linenos="20 "></span>  &#39;id&#39;: &#39;TRAIN_186&#39;,
<span class="linenos" data-linenos="21 "></span>  &#39;title&#39;: &#39;范廷颂&#39;},
<span class="linenos" data-linenos="22 "></span>...
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">paragraphs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储所有段落的内容</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">questions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储所有问题的内容</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">start_positions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储所有答案的开始位置</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">end_positions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储所有答案的结束位置</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>  <span class="c1"># 遍历训练数据的每个段落</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">for</span> <span class="n">qa</span> <span class="ow">in</span> <span class="n">paragraph</span><span class="p">[</span><span class="s2">&quot;paragraphs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;qas&quot;</span><span class="p">]:</span>  <span class="c1"># 遍历每个段落中的所有问答</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="c1">### START CODE HERE ###</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="c1"># 对于每个问题，将其所在段落、问题内容、答案开始位置和结束位置（计算得出）添加到相应的列表中</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">paragraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">[</span><span class="s2">&quot;paragraphs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;context&quot;</span><span class="p">])</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><a href="#__codelineno-11-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">questions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qa</span><span class="p">[</span><span class="s2">&quot;question&quot;</span><span class="p">])</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><a href="#__codelineno-11-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">start_position</span> <span class="o">=</span> <span class="n">qa</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;answer_start&quot;</span><span class="p">]</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><a href="#__codelineno-11-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">start_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_position</span><span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><a href="#__codelineno-11-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">answer_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qa</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><a href="#__codelineno-11-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">end_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_position</span> <span class="o">+</span> <span class="n">answer_length</span><span class="p">)</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><a href="#__codelineno-11-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="c1">### END CODE HERE ###</span>
</code></pre></div>
<p>查看前 5 个问题：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">questions</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>[&#39;范廷颂是什么时候被任为主教的？&#39;,
<span class="linenos" data-linenos="2 "></span> &#39;1990 年，范廷颂担任什么职务？&#39;,
<span class="linenos" data-linenos="3 "></span> &#39;范廷颂是于何时何地出生的？&#39;,
<span class="linenos" data-linenos="4 "></span> &#39;1994 年 3 月，范廷颂担任什么职务？&#39;,
<span class="linenos" data-linenos="5 "></span> &#39;范廷颂是何时去世的？&#39;]
</code></pre></div>
<p>查看前 5 个答案的起始位置：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">start_positions</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>[30, 41, 97, 548, 759]
</code></pre></div>
<p>查看前 5 个答案的结束位置：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">end_positions</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>[35, 62, 126, 598, 780]
</code></pre></div>
<p>查看第 3 个问题的回答是否正确：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">paragraphs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start_positions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="n">end_positions</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;范廷颂于 1919 年 6 月 15 日在越南宁平省天主教发艳教区出生&#39;
</code></pre></div>
<h2 id="对-paragraphs-和-questions-进行-encoding">对 paragraphs 和 questions 进行 Encoding<a class="headerlink" href="#对-paragraphs-和-questions-进行-encoding" title="定位到这">&para;</a></h2>
<p>将 paragraphs 和 questions 进行 encoding。下面这段代码使用了 Hugging Face 的 tokenizer 方法，将 paragraphs 和 questions 转换成相应的 token，返回一个字典 (train_encodings) 包含这些 token 的各种信息，这些信息包括 input_ids、attention_mask 等等。return_tensors='pt' 表示返回 PyTorch 下的 tensor 格式 padding 用于填充不足 max_length 的 tokentruncation 用于在超过 max_length 时截断 token 最终的 token 长度被限制在 512 内。</p>
<p>参考：</p>
<p><a href="https://huggingface.co/docs/transformers/main_classes/tokenizer#transformers.PreTrainedTokenizer.__call__" target="_blank" rel="noopener">https://huggingface.co/docs/transformers/main_classes/tokenizer#transformers.PreTrainedTokenizer.<strong>call</strong></a></p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">paragraphs</span><span class="p">,</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">questions</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><a href="#__codelineno-16-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><a href="#__codelineno-16-8"><span class="linenos" data-linenos="8 "></span></a><span class="p">)</span>
</code></pre></div>
<p>查看 train_encodings 的 keys：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>dict_keys([&#39;input_ids&#39;, &#39;token_type_ids&#39;, &#39;attention_mask&#39;])
</code></pre></div>
<ul>
<li>
<p>在问答任务中，<code>input_ids</code> 是将输入文本转换为整数序列后的输出。它将每个单词或子词映射到一个唯一的整数 ID, 位于 [CLS] 和 [SEP] 标记会被分别映射到一个特殊的 ID，(101: CLS, 102: SEP)。具体可以参考下方例子。</p>
</li>
<li>
<p>在 <code>token_type_ids</code> 中，这些标记的值通常为 0 或 1，其中 0 表示该 token 属于第一个文本序列（通常是段落），1 表示该 token 属于第二个文本序列（通常是问题）。</p>
</li>
<li>
<p>在 <code>attention_mask</code> 中，0 表示对应的标记应该被忽略，1 表示对应的标记应该被关注。当输入序列长度不足最大长度时，我们需要在序列末尾填充一些无意义的标记，以使序列长度达到最大长度。在这种情况下，<code>tokenizer</code>将填充的标记的 attention mask 设置为 0，以告诉模型它们不应该被关注。</p>
</li>
</ul>
<h3 id="input_ids"><code>input_ids</code><a class="headerlink" href="#input_ids" title="定位到这">&para;</a></h3>
<p>让我们来看看 <code>input_ids</code> 的具体内容，以下先向 <code>tokenizer</code> 输入一个段落和一个问题，然后查看 <code>input_ids</code> 的内容。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">paragraph_and_question</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">paragraphs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">questions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><a href="#__codelineno-18-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><a href="#__codelineno-18-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><a href="#__codelineno-18-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><a href="#__codelineno-18-8"><span class="linenos" data-linenos="8 "></span></a><span class="p">)[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">paragraph_and_question</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>tensor([ 101, 5745, 2455, 7563, 3364, 3322, 8020, 8024, 8021, 8024, 1760, 1399,
<span class="linenos" data-linenos=" 2 "></span>         924, 4882,  185, 5735, 4449, 8020, 8021, 8024, 3221, 6632, 1298, 5384,
<span class="linenos" data-linenos=" 3 "></span>        7716, 1921,  712, 3136, 3364, 3322,  511, 9155, 2399, 6158,  818,  711,
<span class="linenos" data-linenos=" 4 "></span>         712, 3136, 8039, 8431, 2399, 6158, 3091, 1285,  711, 1921,  712, 3136,
<span class="linenos" data-linenos=" 5 "></span>        3777, 1079, 2600, 3136, 1277, 2134, 2429, 5392, 4415, 8039, 8447, 2399,
<span class="linenos" data-linenos=" 6 "></span>        6158, 3091, 1285,  711, 2600,  712, 3136, 8024, 1398, 2399, 2399, 2419,
<span class="linenos" data-linenos=" 7 "></span>        6158, 3091, 1285,  711, 3364, 3322, 8039, 8170, 2399,  123, 3299, 4895,
<span class="linenos" data-linenos=" 8 "></span>         686,  511, 5745, 2455, 7563,  754, 9915, 2399,  127, 3299, 8115, 3189,
<span class="linenos" data-linenos=" 9 "></span>        1762, 6632, 1298, 2123, 2398, 4689, 1921,  712, 3136, 1355, 5683, 3136,
<span class="linenos" data-linenos="10 "></span>        1277, 1139, 4495, 8039, 4997, 2399, 3198, 2970, 1358, 5679, 1962, 3136,
<span class="linenos" data-linenos="11 "></span>        5509, 1400, 8024, 6158,  671,  855, 6632, 1298, 4868, 4266, 2372, 1168,
<span class="linenos" data-linenos="12 "></span>        3777, 1079, 5326, 5330, 1071, 2110,  689,  511, 5745, 2455, 7563,  754,
<span class="linenos" data-linenos="13 "></span>        9211, 2399, 1762, 3777, 1079, 1920,  934, 6887, 7368, 2130, 2768, 4868,
<span class="linenos" data-linenos="14 "></span>        2110, 2110,  689,  511, 5745, 2455, 7563,  754, 8594, 2399,  127, 3299,
<span class="linenos" data-linenos="15 "></span>         127, 3189, 1762, 3777, 1079, 4638,  712, 3136, 2429, 1828, 3232, 7195,
<span class="linenos" data-linenos="16 "></span>        8039, 1350, 1400, 6158, 3836, 1168, 1760, 1957, 2207, 2548, 1065, 2109,
<span class="linenos" data-linenos="17 "></span>        1036, 7368, 3302, 1218,  511, 8707, 2399,  807, 8024, 5745, 2455, 7563,
<span class="linenos" data-linenos="18 "></span>        1762, 3777, 1079, 1828, 1277, 1158, 2456, 4919, 3696, 2970, 2521,  704,
<span class="linenos" data-linenos="19 "></span>        2552,  809, 3119, 2159, 1168, 3777, 1079, 6912, 2773, 4638, 7410, 3696,
<span class="linenos" data-linenos="20 "></span>         511, 9258, 2399, 8024, 3791, 6632, 2773,  751, 5310, 3338, 8024, 6632,
<span class="linenos" data-linenos="21 "></span>        1298, 3696,  712, 1066, 1469, 1744, 2456, 6963, 3777, 1079, 8024, 2496,
<span class="linenos" data-linenos="22 "></span>        3198, 2523, 1914, 1921,  712, 3136, 4868, 5466,  782, 1447, 6845, 5635,
<span class="linenos" data-linenos="23 "></span>        6632, 1298, 4638, 1298, 3175, 8024,  852, 5745, 2455, 7563,  793, 4197,
<span class="linenos" data-linenos="24 "></span>        4522, 1762, 3777, 1079,  511, 5422, 2399, 5052, 4415, 1760, 5735, 3307,
<span class="linenos" data-linenos="25 "></span>        2207,  934, 7368, 8039, 2668, 1762, 8779, 2399, 1728, 2932, 1310,  934,
<span class="linenos" data-linenos="26 "></span>        7368, 4638, 5632, 4507,  510, 5632, 3780, 1350, 2867, 5318, 3124, 2424,
<span class="linenos" data-linenos="27 "></span>        1762,  934, 7368, 6392, 3124, 3780, 6440, 4638, 6206, 3724, 5445, 6158,
<span class="linenos" data-linenos="28 "></span>        2936,  511, 9155, 2399,  125, 3299,  126, 3189, 8024, 3136, 2134,  818,
<span class="linenos" data-linenos="29 "></span>        1462, 5745, 2455, 7563,  711, 1921,  712, 3136, 1266, 2123, 3136, 1277,
<span class="linenos" data-linenos="30 "></span>         712, 3136, 8024, 1398, 2399,  129, 3299, 8115, 3189, 2218,  818, 8039,
<span class="linenos" data-linenos="31 "></span>        1071, 4288, 7208,  711,  519, 2769,  928, 1921,  712, 4638, 4263,  520,
<span class="linenos" data-linenos="32 "></span>         511, 4507,  754, 5745, 2455, 7563, 6158, 6632, 1298, 3124, 2424, 6763,
<span class="linenos" data-linenos="33 "></span>        4881, 2345,  679, 1914, 8114, 2399, 8024, 1728, 3634,  800, 3187, 3791,
<span class="linenos" data-linenos="34 "></span>        1168, 2792, 2247, 1828, 1277, 6822, 6121, 4288, 4130, 2339,  868, 5445,
<span class="linenos" data-linenos="35 "></span>         683, 3800, 4777, 6438, 5023, 2339,  868,  511, 5745, 2455, 7563, 7370,
<span class="linenos" data-linenos="36 "></span>         749, 7481, 2190, 2773,  751,  510, 6577, 1737,  510, 6158, 2496, 2229,
<span class="linenos" data-linenos="37 "></span>        6833, 2154, 1921,  712, 3136,  833, 5023, 7309, 7579, 1912, 8024,  738,
<span class="linenos" data-linenos="38 "></span>        4908, 2166, 2612, 1908,  934, 7368,  510, 1158, 2456, 1957,  934,  833,
<span class="linenos" data-linenos="39 "></span>        1730,  860, 5023,  511, 8431, 2399, 8024, 3136, 2134, 5735, 3307,  924,
<span class="linenos" data-linenos="40 "></span>        4882,  753,  686, 1762, 1398, 2399,  127, 3299, 8123, 3189, 3091, 1285,
<span class="linenos" data-linenos="41 "></span>        5745, 2455, 7563,  711, 1921,  712, 3136, 3777, 1079, 2600, 3136, 1277,
<span class="linenos" data-linenos="42 "></span>        2134, 2429, 5392,  102, 5745, 2455, 7563, 3221,  784,  720, 3198,  952,
<span class="linenos" data-linenos="43 "></span>        6158,  818,  711,  712, 3136, 4638, 8043,  102])
</code></pre></div>
<p>可以看到，最后一个 token 是 102，并且倒数第 2 行也有一个 102。</p>
<p>102 表示这是一个句子的结束标志，因此从 5745 开始应该是问题。5745 是倒数第 16 个元素，我们可以将最后 16 个元素截取出来并 decode 解码，看看是什么。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">paragraph_and_question</span><span class="p">[</span><span class="o">-</span><span class="mi">16</span><span class="p">:])</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;范 廷 颂 是 什 么 时 候 被 任 为 主 教 的 ？ [SEP]&#39;
</code></pre></div>
<p>可以看出，最后 16 个元素确实是一个 question。</p>
<p>由于我们限制了 <code>max_length</code> 为 512，因此 <code>input_ids</code> 的长度为 512。paragraph 的长度可能超过 512，因此我们需要将其截断。</p>
<p>我们可以看看倒数第 50 到倒数第 16 个元素是什么。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">paragraph_and_question</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:</span><span class="o">-</span><span class="mi">16</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;， 教 宗 若 望 保 禄 二 世 在 同 年 6 月 18 日 擢 升 范 廷 颂 为 天 主 教 河 内 总 教 区 宗 座 署 [SEP]&#39;
</code></pre></div>
<p>这确实是一个 paragraph 的一部分，但它并不是一个完整的句子。这是因为我们使用了 <code>truncation</code> 参数，paragraph 加上 question 会超过 <code>max_length</code>。完整保留 question 后，paragraph 后面的部分就被截断了。</p>
<p>为了验证确实是截断了 paragraph，我们可以只将 paragraph 作为输入，看看 <code>input_ids</code> 最后 50 个字符的内容。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">paragraph_only</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">paragraphs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><a href="#__codelineno-22-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><a href="#__codelineno-22-6"><span class="linenos" data-linenos="6 "></span></a>    <span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><a href="#__codelineno-22-7"><span class="linenos" data-linenos="7 "></span></a><span class="p">)[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">paragraph_only</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:])</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;， 教 宗 若 望 保 禄 二 世 在 同 年 6 月 18 日 擢 升 范 廷 颂 为 天 主 教 河 内 总 教 区 宗 座 署 理 以 填 补 该 教 区 总 主 教 的 空 缺 。 1994 年 [SEP]&#39;
</code></pre></div>
<h3 id="token_type_ids"><code>token_type_ids</code><a class="headerlink" href="#token_type_ids" title="定位到这">&para;</a></h3>
<p><code>token_type_ids</code> 最后 16 个元素为 1，这说明最后 16 个 token 对应的是 question。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;token_type_ids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<span class="linenos" data-linenos="2 "></span>        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<span class="linenos" data-linenos="3 "></span>        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1,
<span class="linenos" data-linenos="4 "></span>        1, 1, 1, 1, 1, 1, 1, 1])
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;token_type_ids&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([[0, 0, 0,  ..., 1, 1, 1],
<span class="linenos" data-linenos="2 "></span>        [0, 0, 0,  ..., 1, 1, 1],
<span class="linenos" data-linenos="3 "></span>        ...,
<span class="linenos" data-linenos="4 "></span>        [0, 0, 0,  ..., 0, 0, 0],
<span class="linenos" data-linenos="5 "></span>        [0, 0, 0,  ..., 0, 0, 0]])
</code></pre></div>
<h3 id="attention_mask"><code>attention_mask</code><a class="headerlink" href="#attention_mask" title="定位到这">&para;</a></h3>
<p>对于那些有截断了数据，<code>attention_mask</code> 全是 1，这说明所有的 token 都是需要关注的。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
<span class="linenos" data-linenos="2 "></span>        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
<span class="linenos" data-linenos="3 "></span>        1, 1, 1, 1, 1, 1, 1, 1])
</code></pre></div>
<p>对于那些没有截断的数据，<code>attention_mask</code> 最后若干个元素为 0，这说明最后一些 token 对应的是补充的 padding 数据，不需要关注。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
<span class="linenos" data-linenos="2 "></span>        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
<span class="linenos" data-linenos="3 "></span>        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0,
<span class="linenos" data-linenos="4 "></span>        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<span class="linenos" data-linenos="5 "></span>        0, 0, 0, 0, 0, 0, 0, 0])
</code></pre></div>
<p>长度不足 512 的文本，不会被截断，而是会被填充 0。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>tensor([ 101,  711, 3189, 3315, 4035, 4514, 6639, 4413, 2207, 2199, 5437, 4638,
<span class="linenos" data-linenos=" 2 "></span>         671,  702, 6235, 5682, 8024, 5632, 2207, 4266, 3678, 4895, 2460, 8024,
<span class="linenos" data-linenos=" 3 "></span>         680, 4266,  779,  671, 6629, 1724, 1905,  711, 2157, 8024, 3680,  702,
<span class="linenos" data-linenos=" 4 "></span>        1765, 3175,  738, 3221, 2521,  671,  833,  912, 4895, 2458, 8024,  852,
<span class="linenos" data-linenos=" 5 "></span>         800,  793, 4197, 5543, 1916,  924, 2898,  831, 4899, 4638, 2110,  689,
<span class="linenos" data-linenos=" 6 "></span>        2768, 5327,  511, 1762, 5018,  671, 3613, 1298, 5867, 2356, 4495, 3833,
<span class="linenos" data-linenos=" 7 "></span>        3198, 8024,  680, 1398, 3416, 2218, 6438,  754, 1298, 5867, 2207, 2110,
<span class="linenos" data-linenos=" 8 "></span>        4638, 1920, 4958, 5437,  711, 7942, 7032, 2864, 3440, 8024, 3295, 3126,
<span class="linenos" data-linenos=" 9 "></span>        1213, 4413, 7339, 1259, 2886, 1298, 5867, 2207, 2110,  510, 1298, 5867,
<span class="linenos" data-linenos="10 "></span>        7770,  704,  510, 3189, 3315, 2208, 2399, 7339,  510, 3189, 3315, 7471,
<span class="linenos" data-linenos="11 "></span>        2399, 1092,  510, 3189, 3315, 1952, 6817, 7339,  511, 3126, 1213, 3189,
<span class="linenos" data-linenos="12 "></span>        3315, 7471, 2399, 1092, 3309, 7313, 8024, 1728, 3131, 1398, 3678, 2460,
<span class="linenos" data-linenos="13 "></span>        4266, 4638, 1987, 1987, 2193, 5636, 6158, 6756, 3058, 5635, 3171, 5558,
<span class="linenos" data-linenos="14 "></span>        8024, 1762, 1104, 6612, 1453, 1372, 1762, 1104, 6612, 4638,  678, 1288,
<span class="linenos" data-linenos="15 "></span>        1767, 1282,  758, 1146, 7164, 2458, 1993,  677, 1767, 8024, 2768,  711,
<span class="linenos" data-linenos="16 "></span>        3189, 3315, 7339, 1932, 2533,  686, 7471, 1094, 1092, 4638, 1071,  704,
<span class="linenos" data-linenos="17 "></span>         671, 1399, 1216, 5628,  511, 1825, 3315, 6598, 3160, 5333, 1384, 8038,
<span class="linenos" data-linenos="18 "></span>        4413, 1767,  677, 4638, 5686, 3318, 2157, 1139, 6716, 1765, 8038, 3189,
<span class="linenos" data-linenos="19 "></span>        3315, 1298, 5867, 2356, 6414, 4495, 3189, 8038,  126, 3299,  126, 3189,
<span class="linenos" data-linenos="20 "></span>        3215, 2429, 8038, 7032, 4281, 2429, 4413, 6132, 1384, 4772, 8038, 8111,
<span class="linenos" data-linenos="21 "></span>        2857,  818,  855, 5390, 8038,  704, 1767,  510, 3122, 1140,  704, 1767,
<span class="linenos" data-linenos="22 "></span>         510, 1381,  704, 1767, 3078, 7270, 5558, 8038, 1381, 5558, 2792, 2247,
<span class="linenos" data-linenos="23 "></span>        7339,  824, 8038, 4669, 4506, 2255, 1383, 3125,  752, 1355, 2245, 2274,
<span class="linenos" data-linenos="24 "></span>        1922, 6947, 1762, 2207, 2110, 3309, 7313,  679, 3171, 6760, 2940, 2110,
<span class="linenos" data-linenos="25 "></span>        3413, 8024, 1762, 1298, 5867, 2207, 2110, 2218, 6438, 3198, 1762, 1059,
<span class="linenos" data-linenos="26 "></span>        1744, 1920, 6612,  704, 1932, 2533, 1094, 1092, 8039, 1744,  704,  676,
<span class="linenos" data-linenos="27 "></span>        2399, 7390, 4266,  779, 2109, 1296, 1765, 1762, 3791, 1744, 4522, 2110,
<span class="linenos" data-linenos="28 "></span>        8039, 1726, 1744, 1400,  676, 2399, 4638, 7770,  704, 4495, 3889,  671,
<span class="linenos" data-linenos="29 "></span>        4684, 6783, 5314, 3189, 3315, 4374, 4277, 2198, 2797, 3189, 1403, 2207,
<span class="linenos" data-linenos="30 "></span>        3613, 6947, 4372, 7566, 4638,  691, 6930, 2110, 7368,  511, 1762,  523,
<span class="linenos" data-linenos="31 "></span>         100, 8133,  524, 2399,  807, 8024, 1920, 4958, 5437,  510, 3189, 1403,
<span class="linenos" data-linenos="32 "></span>        2207, 3613, 6947, 5023, 1399, 2199, 1772, 6760, 2773, 3862, 1912, 8024,
<span class="linenos" data-linenos="33 "></span>         800,  680, 3351, 2255, 1045,  510,  676, 3329, 3919, 5299, 2768,  749,
<span class="linenos" data-linenos="34 "></span>         519,  100,  520, 5299, 1394, 8020, 3351, 2255, 1045,  100,  100,  510,
<span class="linenos" data-linenos="35 "></span>        2274, 1922, 6947,  100,  100,  510,  676, 3329, 3919,  100,  100, 8021,
<span class="linenos" data-linenos="36 "></span>         511, 2553, 3324, 2825,  122,  119, 1726, 1213, 1143, 2198, 7305,  123,
<span class="linenos" data-linenos="37 "></span>         119,  100,  119,  100,  119,  100,  119, 2198, 7305,  124,  119, 1352,
<span class="linenos" data-linenos="38 "></span>         782, 2198, 7305,  113,  680, 1920, 4958, 5437, 1394,  868,  114,  102,
<span class="linenos" data-linenos="39 "></span>        3189, 3315, 7339, 1932, 2533,  686, 7471, 1094, 1092, 8024, 2274, 1922,
<span class="linenos" data-linenos="40 "></span>        6947, 1355, 2916,  749,  784,  720,  868, 4500, 8043,  102,    0,    0,
<span class="linenos" data-linenos="41 "></span>           0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
<span class="linenos" data-linenos="42 "></span>           0,    0,    0,    0,    0,    0,    0,    0])
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="n">tokenizer</span><span class="p">(</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="n">paragraphs</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><a href="#__codelineno-29-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="n">questions</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><a href="#__codelineno-29-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><a href="#__codelineno-29-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><a href="#__codelineno-29-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><a href="#__codelineno-29-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><a href="#__codelineno-29-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="p">)[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><a href="#__codelineno-29-10"><span class="linenos" data-linenos="10 "></span></a><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;[CLS] 为 日 本 漫 画 足 球 小 将 翼 的 一 个 角 色 ， 自 小 父 母 离 异 ， 与 父 亲 一 起 四 处 为 家 ， 每 个 地 方 也 是 待 一 会 便 离 开 ， 但 他 仍 然 能 够 保 持 优 秀 的 学 业 成 绩 。 在 第 一 次 南 葛 市 生 活 时 ， 与 同 样 就 读 于 南 葛 小 学 的 大 空 翼 为 黄 金 拍 档 ， 曾 效 力 球 队 包 括 南 葛 小 学 、 南 葛 高 中 、 日 本 少 年 队 、 日 本 青 年 军 、 日 本 奥 运 队 。 效 力 日 本 青 年 军 期 间 ， 因 救 同 母 异 父 的 妹 妹 导 致 被 车 撞 至 断 脚 ， 在 决 赛 周 只 在 决 赛 的 下 半 场 十 五 分 钟 开 始 上 场 ， 成 为 日 本 队 夺 得 世 青 冠 军 的 其 中 一 名 功 臣 。 基 本 资 料 绰 号 ： 球 场 上 的 艺 术 家 出 身 地 ： 日 本 南 葛 市 诞 生 日 ： 5 月 5 日 星 座 ： 金 牛 座 球 衣 号 码 ： 11 担 任 位 置 ： 中 场 、 攻 击 中 场 、 右 中 场 擅 长 脚 ： 右 脚 所 属 队 伍 ： 盘 田 山 叶 故 事 发 展 岬 太 郎 在 小 学 期 间 不 断 转 换 学 校 ， 在 南 葛 小 学 就 读 时 在 全 国 大 赛 中 夺 得 冠 军 ； 国 中 三 年 随 父 亲 孤 单 地 在 法 国 留 学 ； 回 国 后 三 年 的 高 中 生 涯 一 直 输 给 日 本 王 牌 射 手 日 向 小 次 郎 率 领 的 东 邦 学 院 。 在 【 [UNK] 23 】 年 代 ， 大 空 翼 、 日 向 小 次 郎 等 名 将 均 转 战 海 外 ， 他 与 松 山 光 、 三 杉 淳 组 成 了 「 [UNK] 」 组 合 （ 松 山 光 [UNK] [UNK] 、 岬 太 郎 [UNK] [UNK] 、 三 杉 淳 [UNK] [UNK] ） 。 必 杀 技 1. 回 力 刀 射 门 2. [UNK]. [UNK]. [UNK]. 射 门 3. 双 人 射 门 ( 与 大 空 翼 合 作 ) [SEP] 日 本 队 夺 得 世 青 冠 军 ， 岬 太 郎 发 挥 了 什 么 作 用 ？ [SEP]&#39;
</code></pre></div>
<h3 id="查看-input_idstoken_type_ids-和-attention_mask-的维度">查看 <code>input_ids</code>、<code>token_type_ids</code> 和 <code>attention_mask</code> 的维度：<a class="headerlink" href="#查看-input_idstoken_type_ids-和-attention_mask-的维度" title="定位到这">&para;</a></h3>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos="1 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos="2 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;token_type_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos="3 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>torch.Size([10142, 512])
</code></pre></div>
<h2 id="将-answer-在原始-paragrapgh-的起止索引转换为在经过-tokenizor-之后的-input_ids-中的起止索引">将 answer 在原始 paragrapgh 的起止索引，转换为：在经过 tokenizor 之后的 input_ids 中的起止索引<a class="headerlink" href="#将-answer-在原始-paragrapgh-的起止索引转换为在经过-tokenizor-之后的-input_ids-中的起止索引" title="定位到这">&para;</a></h2>
<p>原始的起止索引是单个字符的索引。例如：</p>
<ul>
<li>
<p>paragrapgh: <code>我出生于 2001 年。</code></p>
</li>
<li>
<p>question: <code>我出生于哪一年？</code></p>
</li>
<li>
<p>answer: <code>2001 年。</code></p>
</li>
</ul>
<p>这句话的 <code>2001</code> 的 <code>start_index</code> 是 4，<code>end_index</code> 是 7。</p>
<p>但是，经过 tokenizer 之后，<code>2001</code> 被识别成了 1 个 token。因此 <code>start_index</code> 是 4，<code>end_index</code> 也是 4。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># `char_to_token` will convert answer&#39;s start/end positions in paragraph_text to start/end positions in tokenized_paragraph</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><a href="#__codelineno-31-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;start_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><a href="#__codelineno-31-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="p">[</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><a href="#__codelineno-31-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="n">train_encodings</span><span class="o">.</span><span class="n">char_to_token</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><a href="#__codelineno-31-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="k">if</span> <span class="n">train_encodings</span><span class="o">.</span><span class="n">char_to_token</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><a href="#__codelineno-31-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><a href="#__codelineno-31-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">start_positions</span><span class="p">)</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><a href="#__codelineno-31-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="p">]</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><a href="#__codelineno-31-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="p">)</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><a href="#__codelineno-31-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;end_positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><a href="#__codelineno-31-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="p">[</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><a href="#__codelineno-31-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">train_encodings</span><span class="o">.</span><span class="n">char_to_token</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><a href="#__codelineno-31-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">if</span> <span class="n">train_encodings</span><span class="o">.</span><span class="n">char_to_token</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><a href="#__codelineno-31-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><a href="#__codelineno-31-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">end_positions</span><span class="p">)</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><a href="#__codelineno-31-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="p">]</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><a href="#__codelineno-31-17"><span class="linenos" data-linenos="17 "></span></a><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;start_positions&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([ 31,  39,  86,  ..., 142, 225,  17])
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;end_positions&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([ 32,  56, 110,  ..., 143, 244,  19])
</code></pre></div>
<p>以第 3 个问题为例，即以 86 和 110 作为起止索引为例，查看它们对应的字符串是什么：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">questions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;范廷颂是于何时何地出生的？&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><a href="#__codelineno-35-1"><span class="linenos" data-linenos="1 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;answer 在原始字符串中的起止索引为：&quot;</span><span class="p">,</span> <span class="n">start_positions</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">end_positions</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>answer 在原始字符串中的起止索引为： 97 126
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><a href="#__codelineno-36-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">paragraphs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start_positions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="n">end_positions</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;范廷颂于 1919 年 6 月 15 日在越南宁平省天主教发艳教区出生&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><a href="#__codelineno-37-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">train_encodings</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">86</span> <span class="p">:</span> <span class="mi">110</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;范 廷 颂 于 1919 年 6 月 15 日 在 越 南 宁 平 省 天 主 教 发 艳 教 区 出 生&#39;
</code></pre></div>
<p>可以看出，answer 在原始字符串中的 start_position 为 97，但在经过 tokenizer 之后，start_position 变成了 86。</p>
<h2 id="加载训练数据">加载训练数据<a class="headerlink" href="#加载训练数据" title="定位到这">&para;</a></h2>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><a href="#__codelineno-38-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><a href="#__codelineno-38-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">torch.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><a href="#__codelineno-38-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><a href="#__codelineno-38-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><a href="#__codelineno-38-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">SquadDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><a href="#__codelineno-38-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encodings</span><span class="p">):</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><a href="#__codelineno-38-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">encodings</span> <span class="o">=</span> <span class="n">encodings</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><a href="#__codelineno-38-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><a href="#__codelineno-38-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><a href="#__codelineno-38-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">encodings</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><a href="#__codelineno-38-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><a href="#__codelineno-38-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><a href="#__codelineno-38-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encodings</span><span class="o">.</span><span class="n">input_ids</span><span class="p">)</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a><a href="#__codelineno-38-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><a href="#__codelineno-38-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a><a href="#__codelineno-38-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">SquadDataset</span><span class="p">(</span><span class="n">train_encodings</span><span class="p">)</span>
</code></pre></div>
<h2 id="指定-optimizer-为-adamw">指定 optimizer 为 AdamW<a class="headerlink" href="#指定-optimizer-为-adamw" title="定位到这">&para;</a></h2>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><a href="#__codelineno-39-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">torch.optim</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdamW</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><a href="#__codelineno-39-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><a href="#__codelineno-39-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><a href="#__codelineno-39-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><a href="#__codelineno-39-5"><span class="linenos" data-linenos="5 "></span></a><span class="c1">### START CODE HERE ###</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><a href="#__codelineno-39-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1"># Use AdamW as the optimizer, and learning rate 5e-5.</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><a href="#__codelineno-39-7"><span class="linenos" data-linenos="7 "></span></a><span class="c1"># https://pytorch.org/docs/stable/generated/torch.optim.AdamW.html</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><a href="#__codelineno-39-8"><span class="linenos" data-linenos="8 "></span></a><span class="n">optim</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">)</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><a href="#__codelineno-39-9"><span class="linenos" data-linenos="9 "></span></a><span class="c1">### END CODE HERE ###</span>
</code></pre></div>
<h2 id="加速训练">加速训练<a class="headerlink" href="#加速训练" title="定位到这">&para;</a></h2>
<p>Automatic Mixed Precision (AMP) is available on NVIDIA GPUs that support Tensor Cores, which are specialized hardware units for performing fast matrix multiplication and convolution operations in deep learning. Specifically, Tensor Cores are available on NVIDIA Volta, Turing, and Ampere architectures, which include the following GPU series:</p>
<ul>
<li>Volta: Tesla V100, Titan V</li>
<li>Turing: Quadro RTX, GeForce RTX 20-series, Titan RTX</li>
<li>Ampere: A100, GeForce RTX 30-series, Titan RTX</li>
</ul>
<p>由于 Macbook Pro 不支持 Tensor Cores，因此无法使用 AMP。我们将下面的代码注释掉。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><a href="#__codelineno-40-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># # Change &quot;fp16_training&quot; to True to support automatic mixed precision training (fp16)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><a href="#__codelineno-40-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="c1"># fp16_training = True</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><a href="#__codelineno-40-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><a href="#__codelineno-40-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="c1"># if fp16_training:</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><a href="#__codelineno-40-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="c1">#     try:</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><a href="#__codelineno-40-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="c1">#         importlib.import_module(&quot;accelerate&quot;)</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><a href="#__codelineno-40-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="c1">#         print(&quot;accelerate exists.&quot;)</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><a href="#__codelineno-40-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1">#     except ImportError:</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><a href="#__codelineno-40-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">#         ! pip install accelerate</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><a href="#__codelineno-40-10"><span class="linenos" data-linenos="10 "></span></a><span class="c1">#         print(&quot;accelerate installed.&quot;)</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><a href="#__codelineno-40-11"><span class="linenos" data-linenos="11 "></span></a><span class="c1">#     from accelerate import Accelerator</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><a href="#__codelineno-40-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><a href="#__codelineno-40-13"><span class="linenos" data-linenos="13 "></span></a><span class="c1">#     accelerator = Accelerator()</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><a href="#__codelineno-40-14"><span class="linenos" data-linenos="14 "></span></a><span class="c1">#     device = accelerator.device</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><a href="#__codelineno-40-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><a href="#__codelineno-40-16"><span class="linenos" data-linenos="16 "></span></a><span class="c1"># # Documentation for the toolkit:  https://huggingface.co/docs/accelerate/</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><a href="#__codelineno-41-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># model, optim, train_loader = accelerator.prepare(model, optim, train_loader)</span>
</code></pre></div>
<h2 id="训练模型">训练模型<a class="headerlink" href="#训练模型" title="定位到这">&para;</a></h2>
<h3 id="测试一下训练-1-个-batch-时究竟在做什么">测试一下，训练 1 个 batch 时究竟在做什么<a class="headerlink" href="#测试一下训练-1-个-batch-时究竟在做什么" title="定位到这">&para;</a></h3>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><a href="#__codelineno-42-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><a href="#__codelineno-42-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">loss_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><a href="#__codelineno-42-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">acc_start_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><a href="#__codelineno-42-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">acc_end_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><a href="#__codelineno-43-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># 只加载一个 batch 的数据</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><a href="#__codelineno-43-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)):</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><a href="#__codelineno-43-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">batch_idx</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><a href="#__codelineno-43-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="k">break</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
<span class="linenos" data-linenos=" 2 "></span>To disable this warning, you can either:
<span class="linenos" data-linenos=" 3 "></span>    - Avoid using `tokenizers` before the fork if possible
<span class="linenos" data-linenos=" 4 "></span>    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>  0%|          | 0/634 [00:00&lt;?, ?it/s]
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>0 {&#39;input_ids&#39;: tensor([[ 101, 1102, 3777,  ...,    0,    0,    0],
<span class="linenos" data-linenos=" 9 "></span>        [ 101, 6437, 1923,  ...,    0,    0,    0],
<span class="linenos" data-linenos="10 "></span>        [ 101, 4549, 4565,  ..., 4638, 8043,  102],
<span class="linenos" data-linenos="11 "></span>        ...,
<span class="linenos" data-linenos="12 "></span>        [ 101, 6205, 2335,  ...,    0,    0,    0],
<span class="linenos" data-linenos="13 "></span>        [ 101,  517, 4263,  ..., 4638, 8043,  102],
<span class="linenos" data-linenos="14 "></span>        [ 101, 7942, 7583,  ...,    0,    0,    0]]), &#39;token_type_ids&#39;: tensor([[0, 0, 0,  ..., 0, 0, 0],
<span class="linenos" data-linenos="15 "></span>        [0, 0, 0,  ..., 0, 0, 0],
<span class="linenos" data-linenos="16 "></span>        [0, 0, 0,  ..., 1, 1, 1],
<span class="linenos" data-linenos="17 "></span>        ...,
<span class="linenos" data-linenos="18 "></span>        [0, 0, 0,  ..., 0, 0, 0],
<span class="linenos" data-linenos="19 "></span>        [0, 0, 0,  ..., 1, 1, 1],
<span class="linenos" data-linenos="20 "></span>        [0, 0, 0,  ..., 0, 0, 0]]), &#39;attention_mask&#39;: tensor([[1, 1, 1,  ..., 0, 0, 0],
<span class="linenos" data-linenos="21 "></span>        [1, 1, 1,  ..., 0, 0, 0],
<span class="linenos" data-linenos="22 "></span>        [1, 1, 1,  ..., 1, 1, 1],
<span class="linenos" data-linenos="23 "></span>        ...,
<span class="linenos" data-linenos="24 "></span>        [1, 1, 1,  ..., 0, 0, 0],
<span class="linenos" data-linenos="25 "></span>        [1, 1, 1,  ..., 1, 1, 1],
<span class="linenos" data-linenos="26 "></span>        [1, 1, 1,  ..., 0, 0, 0]]), &#39;start_positions&#39;: tensor([ 38, 108,  19,  81,  10, 330, 204,  12, 170,  44, 246, 473, 263,   8,
<span class="linenos" data-linenos="27 "></span>         37, 270]), &#39;end_positions&#39;: tensor([ 47, 131,  20,  86,  17, 346, 240,  22, 175,  55, 254, 478, 292,  28,
<span class="linenos" data-linenos="28 "></span>         51, 293])}
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><a href="#__codelineno-44-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">batch_idx</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>0
</code></pre></div>
<p>由于 train_loader 设置了 <code>batch_size=16</code>，因此这里每一个批次包含 16 个数据</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><a href="#__codelineno-45-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>torch.Size([16, 512])
</code></pre></div>
<p>下面一共有 16 行、512 列的数据，每一行对应一个样本，每一列对应一个 token。</p>
<ul>
<li>每一行的第一个 token 是 101，对应的是 [CLS]；</li>
<li>有些行的最后一个 token 是 102，对应的是 [SEP]，说明这一行是一个句子的结束，并且很可能是由于太长而被截断的；</li>
<li>有些行的最后一个 token 是 0，对应的是 padding，说明这一行是由于不足 512 个 token 而被填充的。</li>
</ul>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><a href="#__codelineno-46-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([[ 101, 1102, 3777,  ...,    0,    0,    0],
<span class="linenos" data-linenos="2 "></span>        [ 101, 6437, 1923,  ...,    0,    0,    0],
<span class="linenos" data-linenos="3 "></span>        [ 101, 4549, 4565,  ..., 4638, 8043,  102],
<span class="linenos" data-linenos="4 "></span>        ...,
<span class="linenos" data-linenos="5 "></span>        [ 101, 6205, 2335,  ...,    0,    0,    0],
<span class="linenos" data-linenos="6 "></span>        [ 101,  517, 4263,  ..., 4638, 8043,  102],
<span class="linenos" data-linenos="7 "></span>        [ 101, 7942, 7583,  ...,    0,    0,    0]])
</code></pre></div>
<p>将梯度清零，然后将数据输入到模型中，得到输出。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><a href="#__codelineno-47-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">optim</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><a href="#__codelineno-48-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">input_ids</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><a href="#__codelineno-48-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">attention_mask</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">]</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><a href="#__codelineno-48-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">start_positions</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;start_positions&quot;</span><span class="p">]</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><a href="#__codelineno-48-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">end_positions</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;end_positions&quot;</span><span class="p">]</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><a href="#__codelineno-48-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><a href="#__codelineno-48-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><a href="#__codelineno-48-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">input_ids</span><span class="p">,</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><a href="#__codelineno-48-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><a href="#__codelineno-48-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">start_positions</span><span class="o">=</span><span class="n">start_positions</span><span class="p">,</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a><a href="#__codelineno-48-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">end_positions</span><span class="o">=</span><span class="n">end_positions</span><span class="p">,</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a><a href="#__codelineno-48-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">)</span>
</code></pre></div>
<p>output 包含 3 个元素，分别是：</p>
<ul>
<li><code>loss</code>：模型的 loss，若在单个 GPU 上训练，则它是一个标量；若在多个 GPU 上训练，则它是一个向量，我们需要将它求平均，得到一个标量。</li>
<li><code>start_logits</code>：模型预测的 answer 的起始位置的 logits，它的维度为 <code>[batch_size, sequence_length]</code>。我们需要找到每个样本中最大的 logits 的索引，这个位置最有可能是 answer 的起始位置。</li>
<li><code>end_logits</code>：模型预测的 answer 的结束位置的 logits，它的维度为 <code>[batch_size, sequence_length]</code>。我们需要找到每个样本中最大的 logits 的索引，这个位置最有可能是 answer 的结束位置。</li>
</ul>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><a href="#__codelineno-49-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">outputs</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>QuestionAnsweringModelOutput(loss=tensor(6.3551, grad_fn=&lt;DivBackward0&gt;), start_logits=tensor([[ 0.2125, -0.0176,  0.8175,  ..., -0.0908,  0.1679, -0.0031],
<span class="linenos" data-linenos=" 2 "></span>        [-0.2033, -0.3505,  0.3795,  ..., -0.2303, -0.0989, -0.2526],
<span class="linenos" data-linenos=" 3 "></span>        [-0.1405, -0.2148,  0.3679,  ...,  0.4882,  0.4927,  0.1160],
<span class="linenos" data-linenos=" 4 "></span>        ...,
<span class="linenos" data-linenos=" 5 "></span>        [ 0.3012, -0.1959,  0.4851,  ...,  0.1459,  0.0050,  0.0071],
<span class="linenos" data-linenos=" 6 "></span>        [ 0.4969,  0.1853,  0.6557,  ...,  1.1007,  0.5564,  0.6131],
<span class="linenos" data-linenos=" 7 "></span>        [ 0.7602, -0.2658,  0.1790,  ...,  0.0998, -0.0900, -0.1103]],
<span class="linenos" data-linenos=" 8 "></span>       grad_fn=&lt;CloneBackward0&gt;), end_logits=tensor([[ 0.5864,  0.2094, -0.2350,  ...,  0.0376, -0.0851,  0.1369],
<span class="linenos" data-linenos=" 9 "></span>        [ 0.6591,  0.6336, -0.3106,  ..., -0.1314,  0.0859,  0.2088],
<span class="linenos" data-linenos="10 "></span>        [ 0.4751,  0.4456, -0.7501,  ..., -0.4076,  0.6677,  0.2978],
<span class="linenos" data-linenos="11 "></span>        ...,
<span class="linenos" data-linenos="12 "></span>        [ 0.2938,  0.6359,  0.2300,  ..., -0.1223, -0.0624,  0.0244],
<span class="linenos" data-linenos="13 "></span>        [ 0.5656, -0.0421, -0.4359,  ..., -0.3173,  0.4669, -0.0290],
<span class="linenos" data-linenos="14 "></span>        [ 0.5795,  0.6293,  0.0137,  ..., -0.2818, -0.0483,  0.1549]],
<span class="linenos" data-linenos="15 "></span>       grad_fn=&lt;CloneBackward0&gt;), hidden_states=None, attentions=None)
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><a href="#__codelineno-50-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><a href="#__codelineno-51-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">loss</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor(6.3551, grad_fn=&lt;MeanBackward0&gt;)
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><a href="#__codelineno-52-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># accelerator.backward(loss)</span>
</code></pre></div>
<p>将 loss 反向传播，然后更新模型参数：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><a href="#__codelineno-53-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">optim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</code></pre></div>
<p>将 loss 值进行累加：</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><a href="#__codelineno-54-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">loss_sum</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</code></pre></div>
<p>对于第一个问答，输出每个 token 作为 start 的 logit，其值越大，说明越有可能作为 start</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><a href="#__codelineno-55-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">outputs</span><span class="o">.</span><span class="n">start_logits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>tensor([ 0.2125, -0.0176,  0.8175,  0.1401,  0.3830,  0.5447,  0.2535,  0.5441,
<span class="linenos" data-linenos=" 2 "></span>         0.4506,  0.1667, -0.0406,  0.2431,  0.5296,  0.5443,  0.1391,  0.5039,
<span class="linenos" data-linenos=" 3 "></span>         0.5513,  0.3531, -0.0036,  0.5418,  0.3638,  0.8562,  0.7709,  0.4136,
<span class="linenos" data-linenos=" 4 "></span>        -0.1002,  0.3804,  0.5228, -0.3767,  0.8535, -0.4170, -0.2852,  0.2198,
<span class="linenos" data-linenos=" 5 "></span>        -0.0988,  0.2945,  0.2500,  0.5346,  0.2510,  0.3977,  0.1791, -0.1008,
<span class="linenos" data-linenos=" 6 "></span>        -0.1827,  0.8526,  0.0159, -0.1219, -0.2111, -0.4803,  0.0551, -0.0085,
<span class="linenos" data-linenos=" 7 "></span>         0.3079,  0.2909,  0.7248,  0.1219,  0.2148,  0.4679,  0.6030, -0.0318,
<span class="linenos" data-linenos=" 8 "></span>        -0.4633, -0.4084, -0.0116,  0.1284,  0.1204,  0.2487, -0.5812, -0.2066,
<span class="linenos" data-linenos=" 9 "></span>         0.2473,  0.0449, -0.2151,  0.6374,  0.2120,  0.3509,  0.0443, -0.5371,
<span class="linenos" data-linenos="10 "></span>         0.3848,  0.2174,  0.3050,  0.4796,  0.4882,  0.4878,  0.2726,  1.0422,
<span class="linenos" data-linenos="11 "></span>         0.3216, -0.4328, -0.4191, -0.0842, -0.2140, -0.1477, -0.1366,  0.6466,
<span class="linenos" data-linenos="12 "></span>         0.3154,  0.2114,  0.1608,  0.2045, -0.0919,  0.4392, -0.0932,  0.0259,
<span class="linenos" data-linenos="13 "></span>         0.5206,  0.5873,  0.1224,  0.0170, -0.2463, -0.0985, -0.4752, -0.0680,
<span class="linenos" data-linenos="14 "></span>        -0.0785,  0.1700,  0.4130, -0.6297, -0.5192,  0.3324, -0.1612,  0.8141,
<span class="linenos" data-linenos="15 "></span>         0.7047, -0.0652, -0.6879,  0.4414,  0.9682, -0.4101, -0.3696,  0.0626,
<span class="linenos" data-linenos="16 "></span>         0.7201,  0.1437, -0.1224,  0.4853,  0.4180,  0.6894, -0.0080,  0.4638,
<span class="linenos" data-linenos="17 "></span>         0.3224,  0.3924,  0.5430, -0.3150,  0.1130,  0.3327,  0.9553,  0.1766,
<span class="linenos" data-linenos="18 "></span>        -0.1214, -0.0748,  0.2101, -0.2757, -0.3623, -0.2271,  0.7705,  0.2296,
<span class="linenos" data-linenos="19 "></span>         0.4204,  0.2503, -0.1333, -0.6823, -0.3707, -0.4157, -0.5318,  0.2350,
<span class="linenos" data-linenos="20 "></span>         0.0367, -0.4597, -0.2335, -0.0836,  0.0926, -0.5748, -0.4118, -0.3472,
<span class="linenos" data-linenos="21 "></span>        -0.3903,  0.1274,  0.0093,  0.3531,  0.0752, -0.3509, -0.0047, -0.4949,
<span class="linenos" data-linenos="22 "></span>        -0.3875, -0.1310,  0.1725,  0.1557, -0.2232,  0.7752,  0.4941,  0.7711,
<span class="linenos" data-linenos="23 "></span>         0.5737,  0.0653,  0.2567,  0.2475,  0.6255,  0.1423,  0.4833,  0.1594,
<span class="linenos" data-linenos="24 "></span>        -0.3646,  0.1656,  0.6454,  0.5056,  0.1226,  0.3239,  0.1266, -0.1670,
<span class="linenos" data-linenos="25 "></span>         0.5881,  0.2466,  0.5619,  0.3316,  1.0385,  0.5894,  0.7943,  0.2949,
<span class="linenos" data-linenos="26 "></span>         0.2460,  0.1228,  0.2602,  0.5001,  0.3455,  0.0215,  0.0672,  0.3724,
<span class="linenos" data-linenos="27 "></span>         0.5243,  0.0491,  0.4194, -0.0477,  0.3131,  0.2198,  0.1860, -0.0031,
<span class="linenos" data-linenos="28 "></span>        -0.5847, -0.6715, -0.0939,  0.0574,  0.6994,  0.8004,  0.0661, -0.2464,
<span class="linenos" data-linenos="29 "></span>         0.2083, -0.3359, -0.0455,  0.3431,  0.5009,  0.3378,  0.0871,  0.4479,
<span class="linenos" data-linenos="30 "></span>         0.8333, -0.1767,  0.2192,  0.2366, -0.0889, -0.7379, -0.7137, -0.2394,
<span class="linenos" data-linenos="31 "></span>         0.2897, -0.1432,  0.2697, -1.0396,  0.1074, -0.0957, -0.1519,  0.2058,
<span class="linenos" data-linenos="32 "></span>        -0.7276, -0.6365,  0.1310,  0.0410,  0.0610,  0.2857,  0.1487,  0.2475,
<span class="linenos" data-linenos="33 "></span>        -0.3950,  0.2993,  0.3038,  0.4302,  0.5475,  0.4055,  0.4028,  0.3937,
<span class="linenos" data-linenos="34 "></span>         0.4151,  0.2934, -0.4341,  0.1555, -0.0497,  0.3891,  0.4310,  0.3350,
<span class="linenos" data-linenos="35 "></span>         0.2426,  0.3268, -0.1807,  0.2414,  0.5263,  0.4906,  0.0672,  0.4079,
<span class="linenos" data-linenos="36 "></span>         0.5031,  0.4021,  0.5126,  0.3123,  0.5452,  0.4220,  0.2336,  0.6535,
<span class="linenos" data-linenos="37 "></span>         0.1540,  0.4732,  0.8249,  0.1131,  0.4821,  0.7310,  0.3041,  0.2527,
<span class="linenos" data-linenos="38 "></span>         0.4379,  0.2597,  0.1327,  0.9209, -0.1255,  0.5664,  0.0277,  0.4685,
<span class="linenos" data-linenos="39 "></span>         0.3919,  0.3305, -0.1136,  0.6584,  1.1735,  0.2455,  0.3451,  0.1770,
<span class="linenos" data-linenos="40 "></span>         0.1515,  0.5662,  0.8513,  0.5403, -0.4512, -0.3062,  0.2060,  0.3442,
<span class="linenos" data-linenos="41 "></span>         0.2045,  0.7849,  0.3150, -0.0569, -0.2507,  0.1957, -0.0929, -0.1571,
<span class="linenos" data-linenos="42 "></span>         0.2783,  0.3085,  0.0191,  0.1233,  0.0252,  0.4742,  0.6263,  0.3042,
<span class="linenos" data-linenos="43 "></span>         0.6639,  0.5058, -0.1975,  0.1259,  0.4177,  0.1303,  0.5247,  0.2499,
<span class="linenos" data-linenos="44 "></span>        -0.0815, -0.0282,  0.4332,  0.1094,  0.4963, -0.1465,  0.1582, -0.4715,
<span class="linenos" data-linenos="45 "></span>        -0.5223,  0.1088,  0.3296,  0.5983,  0.1077, -0.2420, -0.7281,  0.3860,
<span class="linenos" data-linenos="46 "></span>         0.4557,  0.3288,  0.6238,  0.2216,  0.4434,  0.0476,  0.0969,  0.3931,
<span class="linenos" data-linenos="47 "></span>         0.8894,  0.1470,  0.9491,  0.2486,  0.2623,  0.0245, -0.1257,  0.0433,
<span class="linenos" data-linenos="48 "></span>         0.6014,  0.3871,  0.4724,  0.3186,  0.1811, -0.2717,  0.6531, -0.0603,
<span class="linenos" data-linenos="49 "></span>        -0.4586, -0.3631, -0.5564, -0.0339, -0.2336, -0.2790,  0.2397, -0.0855,
<span class="linenos" data-linenos="50 "></span>         0.0136,  0.3702,  0.0660,  0.4432,  0.1387,  0.2210,  0.7574,  0.0257,
<span class="linenos" data-linenos="51 "></span>         0.6028, -0.5347,  0.1119,  0.4418, -0.0884,  0.4299, -0.1921,  0.1301,
<span class="linenos" data-linenos="52 "></span>        -0.2481, -0.4902, -0.1519, -0.1551,  0.0304,  0.0186,  0.2762, -0.2509,
<span class="linenos" data-linenos="53 "></span>         0.0596,  0.1861,  0.0098,  0.3545,  0.0227,  0.3228,  0.0400,  0.3991,
<span class="linenos" data-linenos="54 "></span>         0.1981, -0.3654, -0.3493,  0.4351,  0.1579,  1.1858,  0.2790,  0.6369,
<span class="linenos" data-linenos="55 "></span>         0.1570, -0.0068,  0.5205,  0.8042, -0.2005,  0.1072,  0.3860, -0.4949,
<span class="linenos" data-linenos="56 "></span>        -0.8076,  0.2753,  0.4907, -0.0517, -0.3666,  0.9987,  0.6335,  0.2978,
<span class="linenos" data-linenos="57 "></span>         0.1904, -0.0268,  0.1084, -0.1994,  0.0377, -0.1858,  0.7314,  0.1077,
<span class="linenos" data-linenos="58 "></span>         0.4524, -0.3251,  0.2856,  0.4970,  0.6726,  0.4166,  0.1171,  0.3717,
<span class="linenos" data-linenos="59 "></span>         0.4084,  0.2922,  0.2872,  0.4913,  0.2816,  0.6087,  0.8251,  0.2142,
<span class="linenos" data-linenos="60 "></span>        -0.0854,  0.7196,  0.6450,  0.4110,  0.3252,  0.4044,  0.4999,  0.4911,
<span class="linenos" data-linenos="61 "></span>         0.2375,  0.3400,  0.1322,  0.1493,  0.0513, -0.0023,  0.1486,  0.0358,
<span class="linenos" data-linenos="62 "></span>         0.2667, -0.0037,  0.5133,  0.3341,  0.4385,  0.2358,  0.4318, -0.0516,
<span class="linenos" data-linenos="63 "></span>         0.0674,  0.2064,  0.2652, -0.0804,  0.0899,  0.0967,  0.0405, -0.0277,
<span class="linenos" data-linenos="64 "></span>         0.0649,  0.0952,  0.0291,  0.1091,  0.0682, -0.0908,  0.1679, -0.0031],
<span class="linenos" data-linenos="65 "></span>       grad_fn=&lt;SelectBackward0&gt;)
</code></pre></div>
<p>以下结果说明，第 4 个问答中，第 310 个 token 最有可能是 start</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><a href="#__codelineno-56-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">start_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([429, 343,  23, 310,   9, 323, 342,  12, 230, 315, 217,  47, 301,  39,
<span class="linenos" data-linenos="2 "></span>        491,  30])
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><a href="#__codelineno-57-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">start_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">start_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><a href="#__codelineno-57-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">end_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">end_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><a href="#__codelineno-58-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">start_pred</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([429, 343,  23, 310,   9, 323, 342,  12, 230, 315, 217,  47, 301,  39,
<span class="linenos" data-linenos="2 "></span>        491,  30])
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><a href="#__codelineno-59-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">end_pred</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>tensor([116,  15, 510, 104,   0,   0,  64, 293, 138,  78, 165,   0,   0, 185,
<span class="linenos" data-linenos="2 "></span>         13, 217])
</code></pre></div>
<h3 id="用所有数据训练模型">用所有数据训练模型<a class="headerlink" href="#用所有数据训练模型" title="定位到这">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">训练过程的关键步骤</p>
<ol>
<li>将梯度清零。</li>
<li>将数据输入到模型中，得到输出。</li>
<li>将 loss 反向传播，然后更新模型参数。这里的 loss 的计算逻辑是：判断模型预测的 start 和 end 的位置是否与真实的 start 和 end 的位置相同，若相同，则 loss 为 0，否则 loss 为 1。这类似于多分类问题，我们可以打印出分类的 accuracy，也就是有多少个起始位置和结束位置都被预测正确了。</li>
<li>将 loss 值进行累加。</li>
</ol>
</div>
<p>我们使用 <code>tqdm</code> 来显示训练的进度，并动态地显示 loss 和 accuracy 的值。</p>
<p>我在 Kaggle、Google Colab、趋动云和本地的 Macbook Pro M1 Pro 四台机器上分别进行了训练。对于单个 Epoch：</p>
<ol>
<li>付费使用的趋动云使用 2 个 GPU 并行训练，效率最高，单个 Epoch 共耗时 4 分 40 秒；</li>
</ol>
<p><img alt="qudongyun" src="../2023-04-18-bert-qa/index-image/qudongyun.png" /></p>
<ol>
<li>免费使用的 Kaggle 耗时 9 分钟，Google Colab 耗时 17 分钟；</li>
</ol>
<p><img alt="kaggle" src="../2023-04-18-bert-qa/index-image/kaggle.png" /></p>
<p><img alt="google-colab" src="../2023-04-18-bert-qa/index-image/google-colab.png" /></p>
<ol>
<li>在 Macbook Pro M1 Pro 上运行效率最低，即使使用了 GPU，单个 Epoch 仍预计耗时 3 小时。</li>
</ol>
<p><img alt="macbook-pro" src="../2023-04-18-bert-qa/index-image/macbook-pro.png" /></p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><a href="#__codelineno-60-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># if fp16_training:</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><a href="#__codelineno-60-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="c1">#     model, optim, train_loader = accelerator.prepare(model, optim, train_loader)</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><a href="#__codelineno-60-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><a href="#__codelineno-60-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a><a href="#__codelineno-60-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a><a href="#__codelineno-60-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">loss_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a><a href="#__codelineno-60-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">acc_start_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a><a href="#__codelineno-60-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">acc_end_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a><a href="#__codelineno-60-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a><a href="#__codelineno-60-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pbar</span><span class="p">):</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a><a href="#__codelineno-60-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">optim</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a><a href="#__codelineno-60-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a><a href="#__codelineno-60-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a><a href="#__codelineno-60-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">]</span>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a><a href="#__codelineno-60-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">start_positions</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;start_positions&quot;</span><span class="p">]</span>
<a id="__codelineno-60-16" name="__codelineno-60-16"></a><a href="#__codelineno-60-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">end_positions</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;end_positions&quot;</span><span class="p">]</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a><a href="#__codelineno-60-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-60-18" name="__codelineno-60-18"></a><a href="#__codelineno-60-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a><a href="#__codelineno-60-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="n">input_ids</span><span class="p">,</span>
<a id="__codelineno-60-20" name="__codelineno-60-20"></a><a href="#__codelineno-60-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
<a id="__codelineno-60-21" name="__codelineno-60-21"></a><a href="#__codelineno-60-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="n">start_positions</span><span class="o">=</span><span class="n">start_positions</span><span class="p">,</span>
<a id="__codelineno-60-22" name="__codelineno-60-22"></a><a href="#__codelineno-60-22"><span class="linenos" data-linenos="22 "></span></a>            <span class="n">end_positions</span><span class="o">=</span><span class="n">end_positions</span><span class="p">,</span>
<a id="__codelineno-60-23" name="__codelineno-60-23"></a><a href="#__codelineno-60-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="p">)</span>
<a id="__codelineno-60-24" name="__codelineno-60-24"></a><a href="#__codelineno-60-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="c1"># 需要注意的是，由于损失值是在多个 GPU 上进行计算的，因此得到的 `loss.out` 是一个向量，而不是一个标量。我们可以用 .mean() 对多块 GPU 上的 loss 值求均值，将其转换为一个标量</span>
<a id="__codelineno-60-25" name="__codelineno-60-25"></a><a href="#__codelineno-60-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-60-26" name="__codelineno-60-26"></a><a href="#__codelineno-60-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="c1"># if fp16_training:</span>
<a id="__codelineno-60-27" name="__codelineno-60-27"></a><a href="#__codelineno-60-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="c1">#     accelerator.backward(loss)</span>
<a id="__codelineno-60-28" name="__codelineno-60-28"></a><a href="#__codelineno-60-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="c1"># else:</span>
<a id="__codelineno-60-29" name="__codelineno-60-29"></a><a href="#__codelineno-60-29"><span class="linenos" data-linenos="29 "></span></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a id="__codelineno-60-30" name="__codelineno-60-30"></a><a href="#__codelineno-60-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="n">optim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-60-31" name="__codelineno-60-31"></a><a href="#__codelineno-60-31"><span class="linenos" data-linenos="31 "></span></a>
<a id="__codelineno-60-32" name="__codelineno-60-32"></a><a href="#__codelineno-60-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="n">loss_sum</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-60-33" name="__codelineno-60-33"></a><a href="#__codelineno-60-33"><span class="linenos" data-linenos="33 "></span></a>
<a id="__codelineno-60-34" name="__codelineno-60-34"></a><a href="#__codelineno-60-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="c1">### START CODE HERE ###</span>
<a id="__codelineno-60-35" name="__codelineno-60-35"></a><a href="#__codelineno-60-35"><span class="linenos" data-linenos="35 "></span></a>        <span class="c1"># Obtain answer by choosing the most probable start position / end position</span>
<a id="__codelineno-60-36" name="__codelineno-60-36"></a><a href="#__codelineno-60-36"><span class="linenos" data-linenos="36 "></span></a>        <span class="c1"># Using `torch.argmax` and its `dim` parameter to extract preditions for start position and end position.</span>
<a id="__codelineno-60-37" name="__codelineno-60-37"></a><a href="#__codelineno-60-37"><span class="linenos" data-linenos="37 "></span></a>        <span class="n">start_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">start_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-60-38" name="__codelineno-60-38"></a><a href="#__codelineno-60-38"><span class="linenos" data-linenos="38 "></span></a>        <span class="n">end_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">end_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-60-39" name="__codelineno-60-39"></a><a href="#__codelineno-60-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-60-40" name="__codelineno-60-40"></a><a href="#__codelineno-60-40"><span class="linenos" data-linenos="40 "></span></a>        <span class="c1"># calculate accuracy for start and end positions. eg., using start_pred and start_positions to calculate acc_start.</span>
<a id="__codelineno-60-41" name="__codelineno-60-41"></a><a href="#__codelineno-60-41"><span class="linenos" data-linenos="41 "></span></a>        <span class="n">acc_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_pred</span> <span class="o">==</span> <span class="n">start_positions</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-60-42" name="__codelineno-60-42"></a><a href="#__codelineno-60-42"><span class="linenos" data-linenos="42 "></span></a>        <span class="n">acc_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_pred</span> <span class="o">==</span> <span class="n">end_positions</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-60-43" name="__codelineno-60-43"></a><a href="#__codelineno-60-43"><span class="linenos" data-linenos="43 "></span></a>        <span class="c1">### END CODE HERE ###</span>
<a id="__codelineno-60-44" name="__codelineno-60-44"></a><a href="#__codelineno-60-44"><span class="linenos" data-linenos="44 "></span></a>
<a id="__codelineno-60-45" name="__codelineno-60-45"></a><a href="#__codelineno-60-45"><span class="linenos" data-linenos="45 "></span></a>        <span class="n">acc_start_sum</span> <span class="o">+=</span> <span class="n">acc_start</span>
<a id="__codelineno-60-46" name="__codelineno-60-46"></a><a href="#__codelineno-60-46"><span class="linenos" data-linenos="46 "></span></a>        <span class="n">acc_end_sum</span> <span class="o">+=</span> <span class="n">acc_end</span>
<a id="__codelineno-60-47" name="__codelineno-60-47"></a><a href="#__codelineno-60-47"><span class="linenos" data-linenos="47 "></span></a>
<a id="__codelineno-60-48" name="__codelineno-60-48"></a><a href="#__codelineno-60-48"><span class="linenos" data-linenos="48 "></span></a>        <span class="c1"># Update progress bar</span>
<a id="__codelineno-60-49" name="__codelineno-60-49"></a><a href="#__codelineno-60-49"><span class="linenos" data-linenos="49 "></span></a>        <span class="n">postfix</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-60-50" name="__codelineno-60-50"></a><a href="#__codelineno-60-50"><span class="linenos" data-linenos="50 "></span></a>            <span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">loss_sum</span><span class="o">/</span><span class="p">(</span><span class="n">batch_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-60-51" name="__codelineno-60-51"></a><a href="#__codelineno-60-51"><span class="linenos" data-linenos="51 "></span></a>            <span class="s2">&quot;acc_start&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">acc_start_sum</span><span class="o">/</span><span class="p">(</span><span class="n">batch_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-60-52" name="__codelineno-60-52"></a><a href="#__codelineno-60-52"><span class="linenos" data-linenos="52 "></span></a>            <span class="s2">&quot;acc_end&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">acc_end_sum</span><span class="o">/</span><span class="p">(</span><span class="n">batch_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-60-53" name="__codelineno-60-53"></a><a href="#__codelineno-60-53"><span class="linenos" data-linenos="53 "></span></a>        <span class="p">}</span>
<a id="__codelineno-60-54" name="__codelineno-60-54"></a><a href="#__codelineno-60-54"><span class="linenos" data-linenos="54 "></span></a>
<a id="__codelineno-60-55" name="__codelineno-60-55"></a><a href="#__codelineno-60-55"><span class="linenos" data-linenos="55 "></span></a>        <span class="c1"># Add batch accuracy to progress bar</span>
<a id="__codelineno-60-56" name="__codelineno-60-56"></a><a href="#__codelineno-60-56"><span class="linenos" data-linenos="56 "></span></a>        <span class="n">batch_desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">, train loss: </span><span class="si">{</span><span class="n">postfix</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-60-57" name="__codelineno-60-57"></a><a href="#__codelineno-60-57"><span class="linenos" data-linenos="57 "></span></a>        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix_str</span><span class="p">(</span>
<a id="__codelineno-60-58" name="__codelineno-60-58"></a><a href="#__codelineno-60-58"><span class="linenos" data-linenos="58 "></span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">batch_desc</span><span class="si">}</span><span class="s2">, acc start: </span><span class="si">{</span><span class="n">postfix</span><span class="p">[</span><span class="s1">&#39;acc_start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, acc end: </span><span class="si">{</span><span class="n">postfix</span><span class="p">[</span><span class="s1">&#39;acc_end&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-60-59" name="__codelineno-60-59"></a><a href="#__codelineno-60-59"><span class="linenos" data-linenos="59 "></span></a>        <span class="p">)</span>
</code></pre></div>
<h2 id="将训练好的模型保存到本地">将训练好的模型保存到本地<a class="headerlink" href="#将训练好的模型保存到本地" title="定位到这">&para;</a></h2>
<p>训练过程十分耗时，因此我们将训练好的模型保存到本地，以便后续直接调用。</p>
<p>注意，使用单 GPU 和使用多 GPU 训练的模型，保存的方式是不同的。</p>
<ul>
<li>对于单 GPU 训练的模型，直接用 <code>.save_pretrained()</code> 方法保存即可；</li>
<li>对于多 GPU 训练的模型，需要先用 <code>.module</code> 属性取出模型，然后再用 <code>.save_pretrained()</code> 方法保存。</li>
</ul>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><a href="#__codelineno-61-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># 对于单 GPU 训练的模型，直接用 .save_pretrained()</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><a href="#__codelineno-61-2"><span class="linenos" data-linenos="2 "></span></a><span class="c1"># model.save_pretrained(&quot;./fengchao-bert-qa&quot;, from_pt=True)</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><a href="#__codelineno-61-3"><span class="linenos" data-linenos="3 "></span></a><span class="c1"># 对于多 GPU 训练得到的模型，要加上 .module</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><a href="#__codelineno-61-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">model</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="s2">&quot;./fengchao-bert-qa&quot;</span><span class="p">,</span> <span class="n">from_pt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h2 id="读取本地训练好的模型">读取本地训练好的模型<a class="headerlink" href="#读取本地训练好的模型" title="定位到这">&para;</a></h2>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><a href="#__codelineno-62-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">model</span> <span class="o">=</span> <span class="n">BertForQuestionAnswering</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;./fengchao-bert-qa&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</code></pre></div>
<h2 id="在新的数据集上进行预测最激动人心的部分">在新的数据集上进行预测（最激动人心的部分）<a class="headerlink" href="#在新的数据集上进行预测最激动人心的部分" title="定位到这">&para;</a></h2>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><a href="#__codelineno-63-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># 定义一个名为 predict 的函数，接收两个参数 doc 和 query</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><a href="#__codelineno-63-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><a href="#__codelineno-63-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="c1"># 输出“段落：”和  doc 的内容</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><a href="#__codelineno-63-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;段落：&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><a href="#__codelineno-63-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="c1"># 输出“提问：”和 query 的内容</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><a href="#__codelineno-63-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;提问：&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><a href="#__codelineno-63-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="c1"># 将 doc 和 query 传递给 tokenizer 函数，将返回结果赋值给 item</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><a href="#__codelineno-63-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">item</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><a href="#__codelineno-63-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="p">[</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="p">],</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><a href="#__codelineno-63-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="p">)</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><a href="#__codelineno-63-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="c1"># 关闭 torch 的梯度计算</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><a href="#__codelineno-63-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><a href="#__codelineno-63-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="c1"># 将 input_ids 和 attention_mask 传递给 model，将返回结果赋值给 outputs</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><a href="#__codelineno-63-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a><a href="#__codelineno-63-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a><a href="#__codelineno-63-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a><a href="#__codelineno-63-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_ids</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">512</span><span class="p">],</span> <span class="n">attention_mask</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">512</span><span class="p">])</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a><a href="#__codelineno-63-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a><a href="#__codelineno-63-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="c1">### START CODE HERE ###</span>
<a id="__codelineno-63-20" name="__codelineno-63-20"></a><a href="#__codelineno-63-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="c1"># 使用 `torch.argmax` 和它的 `dim` 参数来提取开始位置和结束位置的预测结果</span>
<a id="__codelineno-63-21" name="__codelineno-63-21"></a><a href="#__codelineno-63-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">start_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">start_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-63-22" name="__codelineno-63-22"></a><a href="#__codelineno-63-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">end_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">end_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-63-23" name="__codelineno-63-23"></a><a href="#__codelineno-63-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="c1">### END CODE HERE ###</span>
<a id="__codelineno-63-24" name="__codelineno-63-24"></a><a href="#__codelineno-63-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-63-25" name="__codelineno-63-25"></a><a href="#__codelineno-63-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="c1"># 将预测结果转为字符级别</span>
<a id="__codelineno-63-26" name="__codelineno-63-26"></a><a href="#__codelineno-63-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-63-27" name="__codelineno-63-27"></a><a href="#__codelineno-63-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">start_pred</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">token_to_chars</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_pred</span><span class="p">)</span>
<a id="__codelineno-63-28" name="__codelineno-63-28"></a><a href="#__codelineno-63-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">end_pred</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">token_to_chars</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_pred</span><span class="p">)</span>
<a id="__codelineno-63-29" name="__codelineno-63-29"></a><a href="#__codelineno-63-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-63-30" name="__codelineno-63-30"></a><a href="#__codelineno-63-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="c1"># 如果出现异常，则返回“无法找到答案”</span>
<a id="__codelineno-63-31" name="__codelineno-63-31"></a><a href="#__codelineno-63-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="k">return</span> <span class="s2">&quot;无法找到答案&quot;</span>
<a id="__codelineno-63-32" name="__codelineno-63-32"></a><a href="#__codelineno-63-32"><span class="linenos" data-linenos="32 "></span></a>
<a id="__codelineno-63-33" name="__codelineno-63-33"></a><a href="#__codelineno-63-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="c1"># 判断结果是否有效，如果有效则返回结果</span>
<a id="__codelineno-63-34" name="__codelineno-63-34"></a><a href="#__codelineno-63-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="k">if</span> <span class="n">start_pred</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="n">end_pred</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
<a id="__codelineno-63-35" name="__codelineno-63-35"></a><a href="#__codelineno-63-35"><span class="linenos" data-linenos="35 "></span></a>        <span class="c1"># 如果预测的开始位置大于结束位置，则返回“无法找到答案”</span>
<a id="__codelineno-63-36" name="__codelineno-63-36"></a><a href="#__codelineno-63-36"><span class="linenos" data-linenos="36 "></span></a>        <span class="k">return</span> <span class="s2">&quot;无法找到答案&quot;</span>
<a id="__codelineno-63-37" name="__codelineno-63-37"></a><a href="#__codelineno-63-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-63-38" name="__codelineno-63-38"></a><a href="#__codelineno-63-38"><span class="linenos" data-linenos="38 "></span></a>        <span class="c1"># 如果预测的开始位置小于结束位置，则返回预测的答案</span>
<a id="__codelineno-63-39" name="__codelineno-63-39"></a><a href="#__codelineno-63-39"><span class="linenos" data-linenos="39 "></span></a>        <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="n">start_pred</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">end_pred</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>
</code></pre></div>
<h3 id="在-dev-数据上进行检验">在 dev 数据上进行检验：<a class="headerlink" href="#在-dev-数据上进行检验" title="定位到这">&para;</a></h3>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><a href="#__codelineno-64-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><a href="#__codelineno-64-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">predict</span><span class="p">(</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><a href="#__codelineno-64-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">dev</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">100</span><span class="p">][</span><span class="s2">&quot;paragraphs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;context&quot;</span><span class="p">],</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><a href="#__codelineno-64-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">dev</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="mi">100</span><span class="p">][</span><span class="s2">&quot;paragraphs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;qas&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;question&quot;</span><span class="p">],</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><a href="#__codelineno-64-5"><span class="linenos" data-linenos="5 "></span></a><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>段落： 岑朗天（），笔名朗天、霍惊觉。香港作家、影评人、文化活动策划、大学兼职讲师。香港新亚研究所硕士，师从牟宗三，父亲为香港专栏作家昆南。曾在香港多家报社从事繙译、编辑、采访工作。1995 年加入香港电影评论学会，并于 2003-2007 年出任该会会长，2016 年退出。1995 年参与创立新研哲学会，后易名香港人文哲学会，再易名香港人文学会。1998 年加入树宁．现在式单位，出任该剧团董事及编剧。2003 年担任牛棚书展（2003-6）统筹，协助开拓主流以外的书展文化（牛棚书展精神后为九龙城书节继承）。2004 年 6 月至 2011 年加入商业电台光明顶，担任嘉宾主持。2004 年至 2014 年于香港中文大学新闻与传播学院兼职教授媒体创意写作。2012 年始兼任香港浸会大学电影学院讲师，教授文学与影视相关课程。
<span class="linenos" data-linenos="2 "></span>提问： 岑朗天笔名叫什么？
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span>&#39;朗天、霍惊觉&#39;
</code></pre></div>
<h3 id="自定义数据进行检验">自定义数据进行检验<a class="headerlink" href="#自定义数据进行检验" title="定位到这">&para;</a></h3>
<p>用自定义的数据进行测试，模型的效果基本能达到“正确回答小学三年级以下的阅读理解题”的水平，即给定原文后，在原文中找出答案。</p>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><a href="#__codelineno-65-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;勒布朗·詹姆斯是一位美国职业篮球运动员，现效力于洛杉矶湖人队。他身高 203 厘米，体重 113 公斤，司职小前锋/大前锋。詹姆斯出生于俄亥俄州阿克伦市，高中时期便展现出了惊人的篮球天赋，成为高中时期最受瞩目的篮球选手之一。2003 年，他以状元秀的身份进入 NBA 并加入克利夫兰骑士队。在骑士队期间，詹姆斯多次带领球队进入季后赛，并在 2016 年带领球队获得总冠军头衔。此后，他先后效力于迈阿密热火队和克利夫兰骑士队，均取得了显著的成绩。詹姆斯是一个多面手球员，擅长得分、助攻、篮板等多项技术，并在场上表现出很高的篮球智商。他也是一名全方位的球员，场上表现出极强的威慑力，常常成为对手眼中的难题。詹姆斯不仅在 NBA 赛场上成绩斐然，他也是体坛巨星，被誉为篮球界最伟大的球员之一。&quot;</span>
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><a href="#__codelineno-66-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">predict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;詹姆斯在哪个球队？&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;洛杉矶湖人队&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><a href="#__codelineno-67-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">predict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;詹姆斯出生于哪个城市？&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;俄亥俄州阿克伦市&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><a href="#__codelineno-68-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">predict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;詹姆斯是哪一年加入 NBA 的？&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;2003 年&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><a href="#__codelineno-69-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">predict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;詹姆斯有多高？&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;203 厘米&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><a href="#__codelineno-70-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">predict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;詹姆斯在哪一年夺冠？&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;2016 年&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><a href="#__codelineno-71-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">predict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;这段话的主角叫什么名字？&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;勒布朗·詹姆斯&#39;
</code></pre></div>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><a href="#__codelineno-72-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">predict</span><span class="p">(</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><a href="#__codelineno-72-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;对于期货资产，投资者既可以做多也可以做空，因此&quot;上涨趋势&quot;和&quot;下跌趋势&quot;都可以作为交易信号。我们将平均最大回撤和平均最大反向回撤中较小的那一个，作为市场情绪平稳度指标。市场情绪平稳度指标越小，则上涨或者下跌的趋势越强。然后我们再根据具体是上涨还是下跌的趋势，即可判断交易方向。&#39;</span><span class="p">,</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><a href="#__codelineno-72-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;什么资产既可以做多也可以做空？&quot;</span><span class="p">,</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a><a href="#__codelineno-72-4"><span class="linenos" data-linenos="4 "></span></a><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Text Only</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&#39;期货资产&#39;
</code></pre></div>
<h2 id="开放式问题">开放式问题<a class="headerlink" href="#开放式问题" title="定位到这">&para;</a></h2>
<h3 id="bert-固定长度的解决方案">Bert 固定长度的解决方案<a class="headerlink" href="#bert-固定长度的解决方案" title="定位到这">&para;</a></h3>
<p><strong>我们使用了 512 长度的 Bert，但是在实际应用中，输入长度可能大于 512，你想怎么解决这个问题，请描述你的算法，在训练和预测时分别采取什么样的方法。（假设问题的长度都满足小于 512token，段落的长度可能大于 512token，以 QA 问题为例）</strong></p>
<ol>
<li>
<p>在训练阶段，可以使用滑动窗口法生成多个训练样本。具体来说：</p>
</li>
<li>
<p>首先将问题放在末尾，它占据的长度小于 512。</p>
</li>
<li>
<p>如果段落和问题的长度之和小于 512，则用 0 在末尾进行 padding 填充后得到长度为 512 的 样本。</p>
</li>
<li>
<p>如果段落长度大于 512，则将段落滑动切片后放在开头。滑动窗口的大小应使得每个样本都是以 512 为长度的。最后将这些样本输入到 Bert 中进行训练。这样我们就将段落拆分后，与问题合成为多个长度为 512 的样本，每个样本之间的段落会有重叠部分。</p>
</li>
<li>
<p>在预测阶段：</p>
</li>
<li>
<p>如果段落和问题的长度之和小于 512，则用 0 在末尾进行 padding 填充后得到长度为 512 的 样本，再输入到 Bert 中进行预测。</p>
</li>
<li>
<p>如果段落和问题的长度之和小于 512，同样使用滑动窗口法。我们可以得到多个用于预测的样本，如果有 n 个窗口，则会得到 n 个预测结果。每一个预测结果告诉我们：对于截取出的 512 个 token 的样本，answer 的最有可能的起始位置和结束位置是什么。我们再把这 n 个预测结果中 logit 最大的那个预测结果返回即可。</p>
</li>
</ol>
<h3 id="预测-start_pred-和-end_pred-的位置不合理的解决方案">预测 start_pred 和 end_pred 的位置不合理的解决方案<a class="headerlink" href="#预测-start_pred-和-end_pred-的位置不合理的解决方案" title="定位到这">&para;</a></h3>
<p><strong>在输出中，我们分别对 start_pred 和 end_pred 的位置进行预估，如果 end_pred&lt; start_pred，我们可以如何解决这样的问题？</strong></p>
<ol>
<li>可以将 end_pred 与 start_pred 进行比较，若 end_pred&lt; start_pred，则将 end_pred 的值设置为 start_pred 的值。</li>
<li>强制 end_pred&gt;= start_pred。当 end_pred&lt; start_pred 时，只在大于 start_pred 的位置中找到 logit 最大的索引作为 end_pred。</li>
</ol>
<h3 id="bert-的分词方式">Bert 的分词方式<a class="headerlink" href="#bert-的分词方式" title="定位到这">&para;</a></h3>
<p><strong>Bert 的分词方式是什么？在中文中，你觉得这样的方式会带来什么问题？什么样的分词方式适合中文？在中文的文本上，除了改变分词方式，还有哪些方式可以提升模型效果？</strong></p>
<p>阅读资料：<a href="https://github.com/ymcui/Chinese-BERT-wwm" target="_blank" rel="noopener">https://github.com/ymcui/Chinese-BERT-wwm</a></p>
<p>Bert 的分词方式是 WordPiece，即将一个词分解为多个子词，每个子词都是一个 token。例如，<code>doing</code> 可以分解为 <code>do</code> 和 <code>##ing</code>，<code>unwanted</code> 可以分解为 <code>un</code> 和 <code>##want</code> 和 <code>##ed</code>。</p>
<p>但对于中文来说，BERT 采取的是“分字”，也就是将一个词分解为多个字，每个字都是一个 token。例如，<code>做作业</code> 可以分解为 <code>做</code> 和 <code>作</code> 和 <code>业</code>。</p>
<p>拆分成字的方式，可能会丢失某些汉字组成词语后的信息。例如，[<code>打车</code>] 和 [<code>打</code> , <code>车</code>]，这两种拆分方式的含义是有区别的。<code>打车</code> 作为整体时，通常表示表示“寻找出租车”。而 <code>打</code> 和 <code>车</code> 单独拆分后，就没有这个含义了。</p>
<p>我认为，对于中文来说，应该采取“分词”的方式。在语料库中引入常见的词语（例如命名实体、固定搭配等），然后将词语作为 token。</p>
<p>提升模型效果的方法可能有：</p>
<ol>
<li>
<p>扩充语料库。在语料库中包含更多的命名实体、固定搭配等。</p>
</li>
<li>
<p>引入领域特定知识。对于特定领域的中文文本数据，可以尝试使用领域专业知识进行模型训练，例如医学、法律、金融等。</p>
</li>
<li>
<p>数据增强。例如多次翻译（中译英，再英译中）、多次随机替换、多次随机插入、多次随机删除等，可以生成更多的训练数据。</p>
</li>
</ol>
<h2 id="总结">总结<a class="headerlink" href="#总结" title="定位到这">&para;</a></h2>
<p>本文实现了基于 Bert 的中文问答机器人，可以根据提供的原文和提问，在原文中找到最有可能作为答案的文本，这样的智能水平大致相当于小学三年级以下的阅读理解水平。</p>
<p>这个模型并不像那些大语言模型一样具有革命性意义，但毕竟是我亲手训练出来的，它让我完整地实现了从数据预处理、构造数据集、设置训练目标、优化方式等技术细节，在看到它能准确回答我自定义的问题时，我的内心还是很有成就感的。这种感觉就像是自己生了一个小孩一样，教他技能并看着他逐渐学会。</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-custom">2025 年 11 月 15 日</span>
  </span>

    
    
    
    
  </aside>



  



  <h2 id="__comments">评论</h2>
  <script src="https://giscus.app/client.js" data-repo="jeremy-feng/giscus" data-repo-id="R_kgDOJ-MviA" data-category="Announcements" data-category-id="DIC_kwDOJ-MviM4CYC8Y" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
  </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../variable-selection-via-nonconcave-penalized-likelihood/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 使用不同惩罚项的线性回归进行变量选择">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                使用不同惩罚项的线性回归进行变量选择
              </div>
            </div>
          </a>
        
        
          
          <a href="../qlib/" class="md-footer__link md-footer__link--next" aria-label="下一页: Qlib 使用笔记">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Qlib 使用笔记
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <p>Copyright &copy; 2022 - <script>document.write(new Date().getFullYear())</script> Jeremy Feng</p>
    </div>
  
  
</div>
<div class="md-copyright">
  <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">湘 ICP 备 2023001413 号 - 1</a>
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/jeremy-feng" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://x.com/intent/follow?screen_name=JeremyFeng98" target="_blank" rel="noopener" title="X" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:jeremy-feng@qq.com" target="_blank" rel="noopener" title="Email" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2h12.5c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0 1 14.25 14H1.75A1.75 1.75 0 0 1 0 12.25v-8.5C0 2.784.784 2 1.75 2M1.5 12.251c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V5.809L8.38 9.397a.75.75 0 0 1-.76 0L1.5 5.809zm13-8.181v-.32a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25v.32L8 7.88Z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/in/chao-jeremy-feng/" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.expand", "navigation.top", "navigation.indexes", "navigation.footer", "navigation.tracking", "search.share", "search.highlight", "content.action.edit", "content.code.copy", "content.code.annotate", "content.tabs.link", "toc.follow", "header.autohide", "content.tooltips", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": {"Computer Science": "cs", "IndieDev": "indie-dev", "LLM": "llm", "LaTeX": "latex", "LeetCode": "leetcode", "Linux": "linux", "PyTorch": "pytorch", "Python": "python", "Rust": "rust", "\u6570\u636e\u53ef\u89c6\u5316": "visulization", "\u6570\u636e\u5e93": "database", "\u673a\u5668\u5b66\u4e60": "ml", "\u6df1\u5ea6\u5b66\u4e60": "dl", "\u751f\u6d3b": "life", "\u7edf\u8ba1": "stats", "\u8fd0\u7b79\u5b66": "or", "\u91cf\u5316\u7814\u7a76": "quant"}, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>